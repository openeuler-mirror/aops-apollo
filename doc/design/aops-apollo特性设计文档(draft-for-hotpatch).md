# 1ã€ç‰¹æ€§æè¿°

æ“ä½œç³»ç»Ÿä½œä½œä¸ºæ‰€æœ‰è½¯ä»¶çš„åŸºåº§ï¼Œä»£ç é‡å·¨å¤§ï¼Œç¤¾åŒºä¼šåŠæ—¶ä¿®å¤æ¯ä¸€ä¸ªå‘ç°çš„å®‰å…¨æ¼æ´å’Œç¼ºé™·ï¼Œå¦‚æœä¸åŠæ—¶ä¿®å¤è¿™äº›é—®é¢˜ï¼Œå¯èƒ½ä¼šå¸¦æ¥ç³»ç»Ÿå®‰å…¨éšæ‚£å’Œå®•æœºçš„é£é™©ã€‚å½“å‰ç¤¾åŒºå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š  
1. ç›®å‰ä»…æœ‰ä¿®å¤å‘å¸ƒï¼Œæ— å·¥å…·æ”¯æŒæ£€æŸ¥è¿è¡Œç³»ç»ŸCVEå’Œç¼ºé™·çŠ¶æ€ï¼Œä¾èµ–äººä¸ºæ£€æŸ¥ï¼Œå­˜åœ¨å®æ—¶æ€§å’Œé—æ¼é£é™©  
2. æ— çƒ­ä¿®å¤å‘å¸ƒï¼Œä»…æ”¯æŒçƒ­ä¿®å¤ï¼ˆå†…æ ¸/ç”¨æˆ·æ€çƒ­è¡¥ä¸ï¼‰å·¥å…·ï¼Œä½†æ˜¯éœ€è¦ç”¨æˆ·è‡ªå·±åˆ¶ä½œï¼Œä½¿ç”¨å¤æ‚  
3. æ— é›†ç¾¤å·¡æ£€å’Œç®¡ç†èƒ½åŠ›ï¼Œç®¡ç†å‘˜ç»´æŠ¤ç¹å¤  

aops-apolloä¸ºäº†åº”å¯¹å¦‚ä¸Šé—®é¢˜ï¼Œæä¾›äº†ç¼ºé™·ï¼ˆCVE/bugfixï¼‰å·¡æ£€&ä¿®å¤åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½èƒ½å¤Ÿå®šæ—¶æ‰«æé›†ç¾¤ä¸­ä¸»æœºçš„ç¼ºé™·ä¿¡æ¯ï¼Œå¹¶åŠæ—¶å‘ˆç°ç»™ç”¨æˆ·ï¼Œç”¨æˆ·å¯ä»¥åœ¨webç•Œé¢ä¸Šè¿›è¡Œè¿™äº›ç¼ºé™·çš„å¤„ç†ã€‚

## 1.1ã€å—ç›Šäºº

| è§’è‰²     | è§’è‰²æè¿°                                               |
| :------- | :----------------------------------------------------- |
| è¿ç»´äººå‘˜ | è´Ÿè´£æœºå™¨è¿ç»´ç®¡ç†çš„äººå‘˜ï¼ŒåŠæ—¶å‘ç°å’Œä¿®å¤è½¯ä»¶ç¼ºé™·         |
| æ™®é€šç”¨æˆ· | ä¸ªä½“ç”¨æˆ·ï¼Œæ³¨å†ŒæœåŠ¡åï¼Œä¾èµ–äºè¯¥ç³»ç»Ÿå¯¹è‡ªå·±çš„æœºå™¨è¿›è¡Œç›‘æ§ |


## 1.2ã€ä¾èµ–ç»„ä»¶

| ç»„ä»¶          | ç»„ä»¶æè¿°                         | å¯è·å¾—æ€§                        |
| :------------ | :------------------------------- | :------------------------------ |
| mysql         | å…³ç³»å‹æ•°æ®åº“                     | ä½¿ç”¨openEuler repoæºyum install |
| aops-vulcanus | A-Opså·¥å…·åŒ…                      | ä½¿ç”¨openEuler repoæºyum install |
| aops-zeus     | A-Opsèµ„äº§ç®¡ç†æ¨¡å—ï¼Œæ·»åŠ ä¸»æœºéœ€è¦  | ä½¿ç”¨openEuler repoæºyum install |
| aops-ceres    | éƒ¨ç½²åœ¨å®¢æˆ·ç«¯çš„æœåŠ¡ï¼Œæ‰§è¡Œç›¸åº”å‘½ä»¤ | ä½¿ç”¨openEuler repoæºyum install |
| syscare       | çƒ­è¡¥ä¸å·¥å…·é›†                     | ä½¿ç”¨openEuler repoæºyum install |
| rpm       | rpmç®¡ç†å·¥å…·                     | ä½¿ç”¨openEuler repoæºyum install |
| dnf       | è½¯ä»¶åŒ…ç®¡ç†å·¥å…·                     | ä½¿ç”¨openEuler repoæºyum install |

## 1.3ã€License

Mulan V2

# 2ã€éœ€æ±‚åœºæ™¯åˆ†æ

## 2.1ã€apolloéœ€æ±‚åœºæ™¯åˆ†æ
- apolloé€šè¿‡å‘å¸ƒç›®å½•çš„updateinfo.xmlè·å–ç¼ºé™·å‘å¸ƒä¿¡æ¯ï¼Œé€šè¿‡ç›¸å…³å­—æ®µåŒºåˆ†å†·çƒ­è¡¥ä¸ã€‚ç›¸å…³è¡¥ä¸ä»å‘å¸ƒç›®å½•è·å–ï¼Œä½¿ç”¨syscareå’Œdnfå‘½ä»¤å®ç°ç¼ºé™·ç®¡ç†ã€‚ç®¡ç†å‘˜é€šè¿‡apolloçš„cliå’Œwebuiå¯¹é›†ç¾¤æœºå™¨å·¡æ£€å’Œä¿®å¤ã€‚
![apolloä¸Šä¸‹æ–‡è§†å›¾](pic/apos-apolloä¸Šä¸‹æ–‡è§†å›¾.png)
- apolloæä¾›è¡¥ä¸åˆ¶ä½œç»„ä»¶ï¼Œrpmå’Œdnfæ’ä»¶æ¨¡å—ï¼Œå®ç°çƒ­è¡¥ä¸åŠŸèƒ½æ‰©å±•ã€‚å®ç°çƒ­è¡¥ä¸æµæ°´çº¿ï¼Œå®¢æˆ·å¯ä½¿ç”¨rpmå’Œdnfè¿›è¡Œæ“ä½œï¼Œå®ç°ç‹¬ç«‹ä½¿ç”¨å’Œé€‚é…è½»é‡åŒ–åœºæ™¯
![é€»è¾‘æ¶æ„å›¾](pic/é€»è¾‘æ¶æ„å›¾.png)

**éœ€æ±‚å¦‚ä¸‹**
  - [IR-apollo-hotmake]apollo-CICDæµæ°´çº¿æ”¯æŒå†·çƒ­è¡¥ä¸åˆ¶ä½œå’Œå‘å¸ƒ
  - [IR-apollo-hotmakeinfo]apollo-æ”¯æŒCVEå’ŒBugfixä¿¡æ¯å‘å¸ƒï¼Œå¹¶å…³è”å†·çƒ­è¡¥ä¸
  - [IR-apollo-issue_scanf]apollo-ç³»ç»Ÿç¼ºé™·å·¡æ£€
  - [IR-apollo-cold_fix]apollo-ç³»ç»Ÿç¼ºé™·æ”¯æŒå†·è¡¥ä¸ä¿®å¤
  - [IR-apollo-rpm-hot_fix]apollo-æ”¯æŒä½¿ç”¨rpmç®¡ç†çƒ­è¡¥ä¸
  - [IR-apollo-dnf-hot_fix]apollo-æ”¯æŒä½¿ç”¨dnfç®¡ç†çƒ­è¡¥ä¸
  - [IR-apollo-hot_fix]apollo-ç³»ç»Ÿç¼ºé™·æ”¯æŒçƒ­è¡¥ä¸ä¿®å¤

### 2.1.1ã€æ”¯æŒCVEå’ŒBugfixçƒ­è¡¥ä¸åˆ¶ä½œåŠä¿¡æ¯å‘å¸ƒï¼Œå¹¶å…³è”å†·çƒ­è¡¥ä¸
**åŒ…å«IRæ¸…å•**
|IRæè¿°|
|:-----|
|[IR-apollo-hotmake]apollo-CICDæµæ°´çº¿æ”¯æŒå†·çƒ­è¡¥ä¸åˆ¶ä½œå’Œå‘å¸ƒï¼ˆä¸‹åŠå¹´äº¤ä»˜ï¼Œå¾…åˆ†æï¼‰|
|[IR-apollo-hotmakeinfo]apollo-æ”¯æŒCVEå’ŒBugfixä¿¡æ¯å‘å¸ƒï¼Œå¹¶å…³è”å†·çƒ­è¡¥ä¸|

- çƒ­ä¿®å¤é™¤äº†çƒ­è¡¥ä¸é™åˆ¶å¤–ï¼Œè¿˜éœ€è¦è§£å†³æ— ç±³ä¹‹ç‚Šçš„é—®é¢˜ï¼Œé€šè¿‡åœ¨CICDä¸­é›†æˆçƒ­è¡¥ä¸æµæ°´çº¿ï¼Œå®ç°ä¾èµ–PRå®Œæˆçƒ­è¡¥ä¸åˆ¶ä½œã€‚é™¤äº†çƒ­è¡¥ä¸äº¤ä»˜ä»¶æœ¬èº«å¤–ï¼Œè¿˜åœ¨updateinfo.xmlå†…åµŒå…¥çƒ­è¡¥ä¸ä¿¡æ¯ï¼Œç®¡ç†çƒ­è¡¥ä¸åˆ°CVEå’Œbugfixçš„å…³ç³»ã€‚æœ¬ç« èŠ‚ä¸»è¦ä»‹ç»ä¿¡æ¯ç®¡ç†ï¼Œè¯¦ç»†çƒ­è¡¥ä¸æµç¨‹å‚è€ƒ2.1.1
- apolloå‘å¸ƒä»¶æ–°å¢çƒ­è¡¥ä¸åˆ¶ä½œå·¥å…·é›†ï¼Œä¸»è¦åŒ…å«1.çƒ­è¡¥ä¸åˆ¶ä½œç®¡ç†ï¼Œç®¡ç†çƒ­è¡¥ä¸åˆ¶ä½œç¯å¢ƒå’Œæä¾›å¯¹å¤–æ¥å£ï¼›2.æä¾›updateinfo.xmlç”Ÿæˆå·¥å…·ï¼Œæ ¹æ®ä¼ å…¥çš„çƒ­è¡¥ä¸åç§°ï¼ŒPRæè¿°ï¼ˆCVEå’ŒBugfixä¿¡æ¯ï¼‰ç­‰ï¼Œç”Ÿæˆå…·å¤‡çƒ­è¡¥ä¸ä¿¡æ¯æè¿°çš„updateinfo.xmlï¼ˆå¢é‡ï¼‰
![çƒ­è¡¥ä¸å‘å¸ƒæµç¨‹](pic/çƒ­è¡¥ä¸å‘å¸ƒæµç¨‹.png)

**éœ€æ±‚å¦‚ä¸‹**
  - [IR-apollo-hotmakeinfo][SR-hotmakeinfo-001]åˆ›å»ºçƒ­è¡¥ä¸updateinfo.xml
  - [IR-apollo-hotmakeinfo][SR-hotmakeinfo-002]æ”¯æŒæŒ‡å®šç¼ºé™·ç±»å‹/ID/æè¿°/ä¸¥é‡ç­‰çº§/ç¼ºé™·idç­‰
    - å¿…é€‰é¡¹ï¼šupdate-typeï¼Œtitleï¼Œidï¼Œdescriptionï¼Œseverity
    - å¯é€‰é¡¹ï¼šissued-dateï¼Œupdate-statusï¼ˆé»˜è®¤stableï¼‰,issueé“¾æ¥åœ°å€ï¼Œreferences-titleï¼ˆä¸ºç©ºå’Œtitleä¿æŒä¸€è‡´ï¼‰ï¼Œreference-typeï¼ˆä¸update-typeè‡ªåŠ¨å¯¹åº”ï¼‰
    - å…¶ä»–ä¿¡æ¯æ ¹æ®çƒ­è¡¥ä¸åŒ…è‡ªåŠ¨å¡«å……
    - å…¨å±€é…ç½®ï¼šupdate-fromï¼Œrelease
  - [IR-apollo-hotmakeinfo][SR-hotmakeinfo-003]æ”¯æŒæŒ‰ç…§æŒ‡å®šè·¯å¾„å­˜å‚¨updateinfo.xml
  - [IR-apollo-hotmakeinfo][SR-hotmakeinfo-004]æ”¯æŒupdateinfoä¸æ­£å¼è¡¥ä¸åŒ…çš„æ­£ç¡®æ€§æ£€æµ‹
    - ä¼ å…¥updateinfo.xmlå’Œçƒ­è¡¥ä¸åŒ…è·¯å¾„ï¼Œæ£€æµ‹çƒ­è¡¥ä¸æ˜¯å¦çœŸå®å­˜åœ¨ï¼Œæ¯”è¾ƒæ–‡ä»¶åå’Œxmlä¸­æè¿°æ˜¯å¦ä¸€è‡´

**CICDéœ€æ±‚**
  - [CICD-hotmake][SR-hotmake-001]æ”¯æŒPRè¯„è®ºå‘½ä»¤makehotpatchåˆ›å»ºupdateinfo.xml
    - PRåˆå…¥åè‡ªåŠ¨åˆ›å»ºç‰¹å®šæ ¼å¼çš„çƒ­è¡¥ä¸issue
    - å‡†å¤‡çƒ­è¡¥ä¸åˆ¶ä½œç¯å¢ƒï¼šè‡ªåŠ¨æ”¶é›†PRçš„ä»£ç ï¼Œä¿®æ”¹ä¹‹å‰çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ä¿¡æ¯
    - æä¾›åˆ¶ä½œç¯å¢ƒä¸‹è½½åŠŸèƒ½å’ŒæŒ‡å¯¼æ–‡æ¡£ï¼Œä¾›å¼€å‘äººå‘˜è‡ªéªŒè¯
    - æä¾›å¼€å‘ï¼ŒéªŒè¯ï¼Œå‘å¸ƒæµç¨‹ï¼ˆå¾…è¯¦ç»†è®¾è®¡ï¼‰

**updateinfo.xmlå‚è€ƒæ ¼å¼å¦‚ä¸‹**
```xml
<?xml version="1.0" encoding="UTF-8"?>  
<updates>  
     <update from="openeuler.org" type="security/bugfix/feature" status="stable">  
          <id>openEuler-SA-2021-1502</id>  
          <title>An update for polkit is now available for openEuler-20.03-LTS-SP3</title>  
          <severity>Important</severity>  
          <release>openEuler</release>  
          <issued date="2022-01-27"></issued>  
          <references>  
               <reference href="https://nvd.nist.gov/vuln/detail/CVE-2021-4034" id="CVE-2021-4034" title="CVE-2021-4034" type="cve"></reference>  
          </references>
          <description>xxxxxxxxxxxxx</description>
          <pkglist>
               <collection>
                    <name>openEuler</name>
                    <package arch="aarch64/noarch/x86_64" name="polkit" release="9.oe1" version="0.116">
                         <filename>polkit-0.116-9.oe1.aarch64.rpm</filename>
                    </package>
               </collection>
			   //æœ¬æ¬¡æ–°å¢å­—æ®µ
			   <hot_patch_collection>
                    <name>openEuler</name>
                    <package arch="aarch64" name="polkit" release="9.oe1" version="0.116">
                         <filename>polkit-0.116-9.oe1.aarch64.rpm</filename>
                    </package>
                    <package arch="noarch" name="polkit-help" release="9.oe1" version="0.116">
                         <filename>polkit-help-0.116-9.oe1.noarch.rpm</filename>
                    </package>
			   </hot_patch_collection>
          </pkglist>
     </update>
</updates>
```

**æ¥å£æ¸…å•**

è¡¥ä¸åˆ¶ä½œå·¥å…·SystemHotpatchï¼Œæä¾›çƒ­è¡¥ä¸åˆ¶ä½œå’Œè¡¥ä¸ä¿¡æ¯ç”ŸæˆåŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·æ€å’Œå†…æ ¸æ€çƒ­è¡¥ä¸ç”Ÿæˆ

```
shp COMMAND [OPTIONS...]

List of main commandï¼š
build-hp                make hotpatch
build-info              make updateinfo.xml for hotpatch

General build-hp optionsï¼š
  -n, --name <NAME>                      Patch name
      --version <VERSION>                Patch version [default: 1]
      --description <DESCRIPTION>        Patch description [default: None]
      --target-name <TARGET_NAME>        Patch target name
  -t, --target-elfname <TARGET_ELFNAME>  Patch target executable name
      --target-version <TARGET_VERSION>  Patch target version
      --target-release <TARGET_RELEASE>  Patch target release
      --target-license <TARGET_LICENSE>  Patch target license
  -s, --source <SOURCE>                  source package
  -d, --debuginfo <DEBUGINFO>            Debuginfo package
      --workdir <WORKDIR>                Working directory [default: .]
  -o, --output <OUTPUT>                  Generated patch output directory [default: .]
      --kjobs <N>                        Kernel make jobs [default: 32]
      --skip-compiler-check              Skip compiler version check (not recommended)
 
General build-info options:
  --type  <security/bugfix/feature>      Issue type
  --title <TITLE_INFo>                   Issue title
  --id    <ID_NUMBER>                    Issue id
  --description <DESCRIPTION>            Issue description
  --severity <Important/xxxx>            Issue severity
  --output                               Generatd updateinfo.xml output directory

```



### 2.1.2ã€ç³»ç»Ÿç¼ºé™·æ”¯æŒçƒ­è¡¥ä¸ä¿®å¤

**åŒ…å«IRæ¸…å•**

|IRæè¿°|
|:-----|
|[IR-apollo-rpm-hot_fix]apollo-æ”¯æŒä½¿ç”¨rpmç®¡ç†çƒ­è¡¥ä¸|
|[IR-apollo-dnf-hot_fix]apollo-æ”¯æŒä½¿ç”¨dnfç®¡ç†çƒ­è¡¥ä¸|
|[IR-apollo-hot_fix]apollo-ç³»ç»Ÿç¼ºé™·æ”¯æŒçƒ­è¡¥ä¸ä¿®å¤|

- çƒ­è¡¥ä¸æœ€ç»ˆåˆ¶ä½œæˆrpmï¼Œé€šè¿‡updateinfoæä¾›ä¸CVEå’ŒBugfixçš„ä¿¡æ¯ç®¡ç†ã€‚é›†ä¸­é€šè¿‡repoçš„æ–¹å¼å¯¹å¤–å‘å¸ƒã€‚
- æä¾›dnf-plugin-hotpatchä½¿èƒ½dnfæ”¯æŒçƒ­è¡¥ä¸ç®¡ç†ï¼Œæä¾›çƒ­è¡¥ä¸ä¸‹è½½ï¼Œå®‰è£…å’Œå‡çº§æ“ä½œã€‚æä¾›æ ¹æ®updateinfoå‡çº§çƒ­è¡¥ä¸æ“ä½œï¼Œæ”¯æŒinfoï¼Œlistï¼Œupdateï¼Œupdateinfo list/info/summaryï¼Œæ–°å¢update --hotpatchæ¥å£ã€‚
  - updateã€listã€infoç­‰
  - ğŸ”¥çƒ­è¡¥ä¸çš„rpmå¦‚æœè¢«updateæ€ä¹ˆå¤„ç†ï¼Ÿéœ€è¦è¡¥å……å›´ç»•rpmçš„å†·çƒ­è¡¥ä¸æµç¨‹å›¾å’ŒçŠ¶æ€å›¾
- å¯¹å¤–æä¾›CVE/Bugfixå·¡æ£€ã€ä¿®å¤ã€å›é€€å’ŒæŸ¥è¯¢æ“ä½œï¼Œé€šè¿‡é›†ç¾¤ç®¡ç†æ¨¡å—æä¾›é›†ç¾¤å·¡æ£€èƒ½åŠ›
- éœ€è¦æ”¯æŒåœ¨rpmä¿¡æ¯ä¸­è®¾ç½®å’ŒæŸ¥è¯¢çƒ­è¡¥ä¸æ ‡ç­¾ï¼Ÿ

![ç¼ºé™·ä¿®å¤æµç¨‹](pic/ç¼ºé™·ä¿®å¤æµç¨‹.png)

![ç¼ºé™·ä¿¡æ¯æ•°æ®æµç¨‹å›¾](pic/ç¼ºé™·ä¿¡æ¯æ•°æ®æµç¨‹å›¾.png)



**æ¥å£æ¸…å•**

- DNFæ”¯æŒçƒ­è¡¥ä¸

  ç›¸å…³å‘½ä»¤éœ€è¦å¯¹çƒ­è¡¥ä¸ä¾èµ–ï¼Œæ˜¯å¦å·²ç»æ¿€æ´»çƒ­è¡¥ä¸åšåˆ¤æ–­ï¼Œä»¥ä¾¿çƒ­è¡¥ä¸æ­£å¸¸ç”Ÿæ•ˆ

```
dnf updateinfo
Updates Information Summary: available
    184 Security notice(s)
         23 Critical Security notice(s)
         96 Important Security notice(s)
         62 Moderate Security notice(s)
          3 Low Security notice(s)
Hotpatch Infomation Summary: available
    xxx Security notice(s)
         xx Critical Security notice(s)
         xx Important Security notice(s)
         xx Moderate Security notice(s)
          x Low Security notice(s)
  
dnf COMMAND [OPTIONS...]

List of main commandï¼š
  hot-info                Hot patch summary info
  hot-list                Hot patch list
  hot-upgrade             Hot patch upgrade
  hot-remove              Hot patch remove
General DNF options:
  --downloadonly          only download hotpatch
  --load                  Load hotpatch into system
  --active                Active hotpatch
  --deactive              Deactive hotpatch
  --security              Include security relevant hotpatchs, in updates
  --advisory ADVISORY     Include hotpatchs needed to fix the given advisory, in updates
  --cve CVES              Include hotpatchs needed to fix the given CVE, in updates
  --sec-severity {Critical,Important,Moderate,Low} Include security relevant hotpatchs matching the severity, in updates
  --bz BUGZILLA           Include hotpatchs needed to fix the given BZ, in updates
  -h,--help               Help info of hotpatch

```

  

**å¾…åˆ†æå†…å®¹**

|NO|åˆ†æé¡¹|è´£ä»»äºº|é¢„è®¡å®Œæˆæ—¶é—´|åˆ†æç»“è®º|
|:--|:----|:-----|:----------|:------|
|1|specå¦‚ä½•æ–°å¢æ ‡ç­¾\<rpm:sub-type>hotpatch</rpm:sub-type>,å¦‚ä½•æ–°å¢åˆ°primary.xmlä¸­|text|text|text|
|2|rpmæ’ä»¶å¼€å‘æŒ‡å¯¼|text|text|text|
|3|updateinfoä¸­æ–°å¢hot_patch_collectionå¯¹å·²æœ‰æµç¨‹æ˜¯å¦æœ‰å½±å“|text|text|text|
|4|dnfæ’ä»¶å¼€å‘æŒ‡å¯¼|text|text|text|
|5|rpmæ‰©å±•çƒ­è¡¥ä¸åï¼Œå¯¹åŸæœ‰å‡çº§æµç¨‹å½±å“å’ŒçŠ¶æ€å›¾åˆ†æ|èƒ¡å³°|2023-2-8|text|






**å‚è€ƒä¿¡æ¯**
- suseå¯¹metadataçš„å®šä¹‰https://en.opensuse.org/openSUSE:Standards_Rpm_Metadata


---------------

### 2.1.1ã€cveæ‰«æUse Case

- å½“é…ç½®å¥½ç›¸åº”çš„repoæºåï¼Œæ‰§è¡Œä¸€ç§æŒ‡å®šçš„cveæ‰«ææ–¹å¼ï¼ˆå¦‚æ ¹æ®openEulerçš„å®‰å…¨å…¬å‘Šæ¥è¯†åˆ«å½“å‰ç®¡ç†ä¸»æœºå·²å®‰è£…è½¯ä»¶åŒ…çš„cveä¿¡æ¯ï¼‰ï¼Œå³å¯è·å–åˆ°æŸæŒ‡å®šä¸»æœºçš„cveä¿¡æ¯ã€‚
- å¯ä»¥è¯†åˆ«å‡ºç”¨æˆ·éœ€è¦çš„åŠŸèƒ½ä¸ºï¼š
  - å®‰å…¨å…¬å‘Šå¯¼å…¥ï¼Œé¦–å…ˆéœ€è¦ä¸€ä»½å…¨é‡cveä¿¡æ¯æ•°æ®åº“ï¼Œåç»­æ‰èƒ½å…³è”è¿™äº›ä¿¡æ¯ã€‚
  - cveæ‰«æï¼Œè¿™é‡Œæ¶‰åŠåˆ°æ‰«æä»»åŠ¡çš„ç®¡ç†ï¼ˆåˆ›å»ºã€æ‰§è¡Œã€è¿›åº¦æŸ¥è¯¢ã€ç»“æœæŸ¥çœ‹ï¼‰ã€‚
  - æ‰«ææŠ¥å‘Šå¯¼å‡ºï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚

![cveæ‰«æ (1)](pic/cveæ‰«æ.png)

### 2.1.3ã€cveä¿¡æ¯æŸ¥è¯¢Use Case

- æ‰«æå‡ºæ¥çš„ä¿¡æ¯éœ€è¦æ¸…æ™°ç›´è§‚åœ°å‘ˆç°ç»™ç”¨æˆ·ï¼Œå› æ­¤è¦æä¾›ç»™ç”¨æˆ·ä¸€ä¸ªæŸ¥è¯¢çš„ç•Œé¢ã€‚å¹¶ä¸”åœ¨ä¸Šé¢èƒ½å¤Ÿåšä¸€äº›ç­›é€‰å’Œè¯„å®¡ã€‚
- å¯ä»¥è¯†åˆ«å‡ºç”¨æˆ·éœ€è¦çš„åŠŸèƒ½ä¸ºï¼š
  - cveä¿¡æ¯æŸ¥è¯¢ï¼ŒåŒ…æ‹¬cveä¿¡æ¯æ€»è§ˆã€cveåˆ—è¡¨ã€cveè¯¦æƒ…ç­‰
  - ä¸»æœºç»´åº¦æŸ¥è¯¢ï¼Œè·å–ä¸»æœºåˆ—è¡¨ï¼Œè·å–ä¸»æœºçš„cveä¿¡æ¯ç­‰ã€‚
  - cveè¯„å®¡çŠ¶æ€è®¾ç½®ï¼Œç”¨æˆ·å¯å·²è®¾ç½®cveçŠ¶æ€ï¼Œå¦‚æ ‡å¿—æŸcveå·²reviewï¼Œæˆ–å¯å¿½ç•¥ã€‚

![cveä¿¡æ¯æŸ¥è¯¢](pic/cveä¿¡æ¯æŸ¥è¯¢.png)

### 2.1.4ã€cveä¿®å¤Use Case

- å½“ç”¨æˆ·å®Œæˆcveæ‰«æã€è¯„å®¡åï¼Œéœ€è¦å¯¹è¯†åˆ«å‡ºæ¥cveçš„ä¸»æœºè¿›è¡Œä¿®å¤ï¼Œåç«¯é€šè¿‡aopsçš„ç®¡ç†ç»„ä»¶ä¸‹å‘å‘½ä»¤åˆ°agentç«¯çš„æ–¹å¼æ¥æ‰§è¡Œä¿®å¤ä»»åŠ¡ï¼ŒåŒæ—¶éœ€è¦æ”¯æŒcveä¿®å¤å›æ»šã€‚

- å¯ä»¥è¯†åˆ«å‡ºç”¨æˆ·éœ€è¦çš„åŠŸèƒ½ä¸ºï¼š

  - cveä¿®å¤ä»»åŠ¡ç®¡ç†ï¼Œå¦‚æ‰§è¡Œcveæ‰«æï¼ŒæŸ¥çœ‹cveä¿®å¤ä»»åŠ¡çš„è¯¦æƒ…ï¼ŒæŸ¥è¯¢å…·ä½“æŸä¸ªcveçš„è¿›åº¦ï¼ŒçŠ¶æ€æŸ¥è¯¢ï¼Œç»“æœæŸ¥è¯¢ï¼Œæ‰§è¡Œcveä¿®å¤å›æ»šç­‰ã€‚

  - cveä¿®å¤å›æ»šï¼Œå½“ä¿®å¤åå­˜åœ¨é—®é¢˜æ—¶ï¼Œéœ€è¦åŠæ—¶å›æ»šã€‚

![cveä¿®å¤ (1)](pic/cveä¿®å¤.png)

### 2.1.1ã€repoè®¾ç½®Use Case

- è¦å®Œæˆcveç®¡ç†é¦–å…ˆéœ€è¦update repoæºçš„ç®¡ç†ï¼ŒåŸºäºopenEulerçš„å®‰å…¨ç­–ç•¥ï¼šcveåœ¨ä¿®å¤åä¼šä»¥å®‰å…¨å…¬å‘Šä»¥åŠupdateç‰ˆæœ¬çš„å½¢å¼å¯¹å¤–å‘å¸ƒï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨æˆ·é…ç½®openEulerå¯¹åº”ç‰ˆæœ¬çš„update repoæºï¼Œéšåæ‰èƒ½é€šè¿‡yumå‘½ä»¤è·å–åˆ°å½“å‰èŠ‚ç‚¹å­˜åœ¨çš„cveä¿¡æ¯ï¼Œä»¥åŠåšè¿›ä¸€æ­¥çš„cveä¿®å¤æ“ä½œã€‚

- å¯ä»¥è¯†åˆ«å‡ºç”¨æˆ·éœ€è¦çš„åŠŸèƒ½ä¸ºï¼š

  - repoæºç®¡ç†ï¼Œç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹ã€æ·»åŠ ã€æ›´æ–°ã€åˆ é™¤å…¶åä¸‹çš„repoæºã€‚

  - é…ç½®repoæºï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ç»™æŒ‡å®šçš„ä¸»æœºé…ç½®æŒ‡å®šçš„repoæºï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä»»åŠ¡çš„ç®¡ç†ã€‚

  - ä¸‹è½½repoæºæ¨¡æ¿ï¼Œä¸ºæ–¹ä¾¿ç”¨æˆ·æ·»åŠ repoï¼Œä¸“é—¨æä¾›äº†repoæ¨¡æ¿ã€‚

![repoè®¾ç½® (1)](pic/repoè®¾ç½®.png)





## 2.2ã€Storyåˆ†è§£

| Use Case    | Story                                    | æ¨¡å—         | å®ç°ç‰ˆæœ¬  | è¯´æ˜                                 |
| ----------- | ---------------------------------------- | ------------ | --------- | ------------------------------------ |
| repoè®¾ç½®    | æŸ¥çœ‹repoæº                               | repoä¿¡æ¯ç®¡ç† | 22.03     |                                      |
|             | æ·»åŠ repoæº                               | repoä¿¡æ¯ç®¡ç† | 22.03     |                                      |
|             | æ›´æ–°repoæº                               | repoä¿¡æ¯ç®¡ç† | 22.03     |                                      |
|             | åˆ é™¤repoæº                               | repoä¿¡æ¯ç®¡ç† | 22.03     |                                      |
|             | åˆ›å»ºé…ç½®repoæºä»»åŠ¡                       | ä»»åŠ¡ç®¡ç†     | **22.12** | ä¸å†éœ€è¦pb                           |
|             | æŸ¥è¯¢é…ç½®repoæºä»»åŠ¡                       | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | æ‰§è¡Œé…ç½®repoæºä»»åŠ¡                       | ä»»åŠ¡ç®¡ç†     | **22.12** | ç”±ansibleçš„æ‰§è¡Œæ–¹å¼ä¿®æ”¹ä¸ºagentç«¯æ‰§è¡Œ |
|             | æŸ¥è¯¢é…ç½®repoæºä»»åŠ¡è¿›åº¦                   | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | æŸ¥è¯¢é…ç½®repoæºä»»åŠ¡ç»“æœ                   | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | åˆ é™¤é…ç½®repoæºä»»åŠ¡                       | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | ä¸‹è½½repoæºæ¨¡æ¿                           | repoä¿¡æ¯ç®¡ç† | 22.03     |                                      |
| cveæ‰«æ     | å¯¼å…¥/è§£æå®‰å…¨å…¬å‘Š                        | cveä¿¡æ¯ç®¡ç†  | **22.12** | æ”¯æŒè§£æä¸å—å½±å“cve                  |
|             | åˆ›å»ºcveæ‰«æä»»åŠ¡                          | ä»»åŠ¡ç®¡ç†     | **22.12** | æ˜¾å¼åˆ›å»ºcveæ‰«æä»»åŠ¡ï¼Œå¹¶å­˜å‚¨ä»»åŠ¡ä¿¡æ¯  |
|             | æŸ¥è¯¢cveæ‰«æä»»åŠ¡                          | ä»»åŠ¡ç®¡ç†     | **22.12** | æŸ¥è¯¢cveæ‰«æä»»åŠ¡è¯¦æƒ…ï¼Œæ‰©å±•task_type   |
|             | æ‰§è¡Œcveæ‰«æä»»åŠ¡                          | ä»»åŠ¡ç®¡ç†     | **22.12** | ç”±ansibleçš„æ‰§è¡Œæ–¹å¼ä¿®æ”¹ä¸ºagentç«¯æ‰§è¡Œ |
|             | æŸ¥è¯¢cveæ‰«æä»»åŠ¡è¿›åº¦                      | ä»»åŠ¡ç®¡ç†     | **22.12** | ä»»åŠ¡è¿›åº¦æŸ¥è¯¢æ‰©å±•ï¼ˆæ”¯æŒcve_scanï¼‰     |
|             | æŸ¥è¯¢cveæ‰«æç»“æœ                          | ä»»åŠ¡ç®¡ç†     | **22.12** |                                      |
|             | ç”Ÿæˆ/å¯¼å‡ºæ‰«ææŠ¥å‘Š                        | cveä¿¡æ¯ç®¡ç†  | **22.12** |                                      |
|             | æŸ¥è¯¢ä¸»æœºçš„æ‰«æçŠ¶æ€                       | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | åˆ é™¤cveæ‰«æä»»åŠ¡                          | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
| cveä¿¡æ¯æŸ¥è¯¢ | cveç»Ÿè®¡ä¿¡æ¯æ€»è§ˆ                          | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | æŸ¥çœ‹cveåˆ—è¡¨                              | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | æŸ¥çœ‹cveå…·ä½“ä¿¡æ¯                          | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | è·å–æŸcveä¸»æœºç›¸å…³è¯¦ç»†ä¿¡æ¯                | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | è·å–å¤šä¸ªcveå¯¹åº”çš„ä¸»æœºåŸºæœ¬ä¿¡æ¯            | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | è®¾ç½®cveè¯„å®¡çŠ¶æ€                          | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | æŸ¥è¯¢ä¿®å¤cveåçš„ä¸€ç³»åˆ—æ“ä½œ                | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | è·å–ä¸»æœºåˆ—è¡¨                             | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | è·å–ä¸»æœºè¯¦ç»†ä¿¡æ¯ï¼ˆåŸºç¡€ä¿¡æ¯+cveæ•°é‡ç»Ÿè®¡ï¼‰ | cveä¿¡æ¯ç®¡ç†  | 22.03     |                                      |
|             | è·å–æŒ‡å®šä¸»æœºçš„è¯¦ç»†cveä¿¡æ¯                | cveä¿¡æ¯ç®¡ç†  | **22.12** | æ”¯æŒç­›é€‰ä¸å—å½±å“cve                  |
| cveä¿®å¤     | åˆ›å»ºcveä¿®å¤ä»»åŠ¡                          | ä»»åŠ¡ç®¡ç†     | **22.12** | ä¸å†éœ€è¦pb                           |
|             | æŸ¥è¯¢cveä¿®å¤ä»»åŠ¡è¯¦æƒ…                      | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | æ‰§è¡Œcveä¿®å¤ä»»åŠ¡                          | ä»»åŠ¡ç®¡ç†     | **22.12** | ç”±ansibleçš„æ‰§è¡Œæ–¹å¼ä¿®æ”¹ä¸ºagentç«¯æ‰§è¡Œ |
|             | æŸ¥è¯¢cveä¿®å¤ä»»åŠ¡è¿›åº¦                      | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | æŸ¥è¯¢cveä¿®å¤ä»»åŠ¡ä¸»æœºçš„çŠ¶æ€                | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | æŸ¥è¯¢cveä¿®å¤ä»»åŠ¡ç»“æœ                      | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | åˆ é™¤cveä¿®å¤ä»»åŠ¡                          | ä»»åŠ¡ç®¡ç†     | 22.03     |                                      |
|             | å›æ»šcveä¿®å¤                              | ä»»åŠ¡ç®¡ç†     |           |                                      |


# 3ã€æ¨¡å—è®¾è®¡

![image-20220111105908221](pic/aops-apolloæ¨¡å—è®¾è®¡å›¾.png)

- API

  cveç®¡ç†æœåŠ¡å¯¹å¤–æä¾›restful apiæ¥å£ï¼Œå¯ç»“åˆé…å¥—çš„aops-hermesä½¿ç”¨ï¼Œå…¶æä¾›äº†webæ“ä½œç•Œé¢ã€‚

- æœåŠ¡å±‚

  ä¸»è¦åŠŸèƒ½åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯cveä¿¡æ¯ç®¡ç†æ¨¡å—ã€repoä¿¡æ¯ç®¡ç†æ¨¡å—ã€ä»»åŠ¡ç®¡ç†æ¨¡å—ï¼Œå…¶ä¸­ï¼š

  - è´Ÿè´£cveä¿¡æ¯çš„ä¸åŒç»´åº¦çš„ç»Ÿè®¡ï¼ŒcveçŠ¶æ€çš„ä¿®æ”¹ï¼Œå®‰å…¨å…¬å‘Šè§£æï¼›

  - repoç®¡ç†æ¨¡å—è´Ÿè´£update repoæºçš„å¢åˆ æ”¹æŸ¥ç®¡ç†ï¼Œæä¾›äº†repoæºçš„æ¨¡æ¿ä¸‹è½½ï¼›

  - ä»»åŠ¡ç®¡ç†æ¨¡å—è´Ÿè´£cveæ‰«æã€ä¿®å¤ã€å›æ»šã€repoé…ç½®ç­‰ä»»åŠ¡çš„ç”Ÿæˆï¼Œä»»åŠ¡ä¸­é—´çŠ¶æ€çš„å­˜å‚¨ä¸æŸ¥è¯¢ï¼Œä»»åŠ¡æ‰§è¡Œï¼Œä»¥åŠå®šæ—¶ä»»åŠ¡ï¼ˆcveæ‰«æã€cveå®‰å…¨å…¬å‘Šè§£æï¼‰çš„æ‰§è¡Œã€‚

- ä¾èµ–æœåŠ¡/åº“

  è¯¥æœåŠ¡ä¾èµ–äºå…¶ä»–æœåŠ¡/åº“æä¾›çš„åŠŸèƒ½ï¼Œä¸»è¦æ˜¯aops-zeusï¼Œaops-ceresï¼Œaops-vulcanusï¼Œå…¶ä¸­ï¼š

  - aops-zeusæœåŠ¡ä¸ºaopsçš„ç®¡ç†æœåŠ¡ï¼Œæä¾›åŸºæœ¬çš„ä¸»æœºç®¡ç†åŠŸèƒ½ï¼Œä¸ºè¯¥æœåŠ¡æä¾›ä¸»æœºipç­‰åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶æä¾›å‘½ä»¤ä¸‹å‘é€šé“ï¼›
  - aops-ceresæœåŠ¡éƒ¨ç½²åœ¨å®¢æˆ·ç«¯ä¾§ï¼Œæä¾›cveä¿®å¤éœ€è¦çš„ç³»åˆ—å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½ï¼Œå¦‚æ‰§è¡Œcveçš„ä¿®å¤å‘½ä»¤ï¼ˆyum update --cve=xxxï¼‰ï¼›
  - aops-vulcanusä¸ºaopsçš„å·¥å…·åº“ï¼Œæä¾›äº†é…ç½®è§£æã€æ—¥å¿—ç®¡ç†ã€responseå°è£…ç­‰å¸¸ç”¨å·¥å…·åº“ã€‚
  
- æ•°æ®åº“

  è¯¥è½¯ä»¶ä¾èµ–äºä¸¤ä¸ªæ•°æ®åº“ï¼Œåˆ†åˆ«ä¸ºelasticsearchå’Œmysqlï¼Œå…¶ä¸­ï¼š

  - elasticsearchå­˜å‚¨å¤æ‚çš„cveè½¯ä»¶åŒ…ä¿¡æ¯ä»¥åŠä¿®å¤æ—¥å¿—ä¿¡æ¯ï¼›

  - mysqlå­˜å‚¨cveä¸ä¸»æœºçš„å…³ç³»ä¿¡æ¯ã€ä»»åŠ¡çš„åŸºç¡€ä¿¡æ¯ã€‚

## 3.1ã€repoä¿¡æ¯ç®¡ç†

### 3.1.1ã€repoæºæ¨¡æ¿ä¸‹è½½

æä¾›repoæºæ¨¡æ¿ä¸‹è½½ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥åœ¨æ¨¡æ¿ä¸Šç¼–å†™åæäº¤

```shell
[update]
name=update
baseurl=http://repo.openeuler.org/openEuler-22.03/update/$basearch
enabled=1
```

## 3.2ã€cveä¿¡æ¯ç®¡ç†

### 3.2.1ã€cveä¿¡æ¯å¯¼å…¥/è§£æ

cveä¿®å¤ä¿¡æ¯æ¥è‡ªäºå®‰å…¨å…¬å‘Šä¸ä¸å—å½±å“cveä¿¡æ¯ï¼Œéœ€è¦åœ¨ç•Œé¢ä¸Šå¯¼å…¥ï¼Œåšä¸€å®šè§£æåå­˜å…¥æ•°æ®åº“ä¸­ã€‚

#### 3.2.1.1ã€å®‰å…¨å…¬å‘Š

- å®‰å…¨å…¬å‘Šæä¾›äº†å·²ä¿®å¤çš„cveä¿¡æ¯ï¼Œå½“å‰æ”¯æŒæ–‡ä»¶æ ¼å¼ï¼š
  - zipï¼Œä¸ºxmlçš„åˆé›†
  - xml
- å®‰å…¨å…¬å‘Šæ ¼å¼å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<cvrfdoc xmlns="http://www.icasi.org/CVRF/schema/cvrf/1.1" xmlns:cvrf="http://www.icasi.org/CVRF/schema/cvrf/1.1">
	<DocumentTitle xml:lang="en">An update for python-lxml is now available for openEuler-20.03-LTS-SP1 and openEuler-20.03-LTS-SP2 and openEuler-20.03-LTS-SP3</DocumentTitle>
	<DocumentType>Security Advisory</DocumentType>
	<DocumentNotes>
		<Note Title="Synopsis" Type="General" Ordinal="1" xml:lang="en">python-lxml security update</Note>
		<Note Title="Summary" Type="General" Ordinal="2" xml:lang="en">An update for python-lxml is now available for openEuler-20.03-LTS-SP1 and openEuler-20.03-LTS-SP2 and openEuler-20.03-LTS-SP3.</Note>
		<Note Title="Description" Type="General" Ordinal="3" xml:lang="en">XML processing library combining libxml2/libxslt with the ElementTree API.

Security Fix(es):

lxml is a library for processing XML and HTML in the Python language. Prior to version 4.6.5, the HTML Cleaner in lxml.html lets certain crafted script content pass through, as well as script content in SVG files embedded using data URIs. Users that employ the HTML cleaner in a security relevant context should upgrade to lxml 4.6.5 to receive a patch. There are no known workarounds available.(CVE-2021-43818)</Note>
		<Note Title="Topic" Type="General" Ordinal="4" xml:lang="en">An update for python-lxml is now available for openEuler-20.03-LTS-SP1 and openEuler-20.03-LTS-SP2 and openEuler-20.03-LTS-SP3.

openEuler Security has rated this update as having a security impact of high. A Common Vunlnerability Scoring System(CVSS)base score,which gives a detailed severity rating, is available for each vulnerability from the CVElink(s) in the References section.</Note>
		<Note Title="Severity" Type="General" Ordinal="5" xml:lang="en">High</Note>
		<Note Title="Affected Component" Type="General" Ordinal="6" xml:lang="en">python-lxml</Note>
	</DocumentNotes>
	<ProductTree xmlns="http://www.icasi.org/CVRF/schema/prod/1.1">
		<Branch Type="Product Name" Name="openEuler">
			<FullProductName ProductID="openEuler-20.03-LTS-SP1" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">openEuler-20.03-LTS-SP1</FullProductName>
			<FullProductName ProductID="openEuler-20.03-LTS-SP2" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">openEuler-20.03-LTS-SP2</FullProductName>
			<FullProductName ProductID="openEuler-20.03-LTS-SP3" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">openEuler-20.03-LTS-SP3</FullProductName>
		</Branch>
		<Branch Type="Package Arch" Name="aarch64">
			<FullProductName ProductID="python-lxml-debuginfo-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python-lxml-debuginfo-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python3-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python3-lxml-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debugsource-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python-lxml-debugsource-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python2-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python2-lxml-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python2-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python2-lxml-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debugsource-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python-lxml-debugsource-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debuginfo-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python-lxml-debuginfo-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python3-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python3-lxml-4.5.2-4.oe1.aarch64.rpm</FullProductName>			
			<FullProductName ProductID="python2-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python2-lxml-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debugsource-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python-lxml-debugsource-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debuginfo-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python-lxml-debuginfo-4.5.2-4.oe1.aarch64.rpm</FullProductName>
			<FullProductName ProductID="python3-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python3-lxml-4.5.2-4.oe1.aarch64.rpm</FullProductName>
		</Branch>
		<Branch Type="Package Arch" Name="noarch">
			<FullProductName ProductID="python-lxml-help-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python-lxml-help-4.5.2-4.oe1.noarch.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-help-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python-lxml-help-4.5.2-4.oe1.noarch.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-help-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python-lxml-help-4.5.2-4.oe1.noarch.rpm</FullProductName>
		</Branch>
		<Branch Type="Package Arch" Name="src">
			<FullProductName ProductID="python-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python-lxml-4.5.2-4.oe1.src.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python-lxml-4.5.2-4.oe1.src.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python-lxml-4.5.2-4.oe1.src.rpm</FullProductName>
		</Branch>
		<Branch Type="Package Arch" Name="x86_64">
			<FullProductName ProductID="python-lxml-debuginfo-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python-lxml-debuginfo-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python2-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python2-lxml-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python3-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python3-lxml-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debugsource-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP1">python-lxml-debugsource-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debuginfo-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python-lxml-debuginfo-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python3-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python3-lxml-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debugsource-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python-lxml-debugsource-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python2-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP2">python2-lxml-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debuginfo-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python-lxml-debuginfo-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python3-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python3-lxml-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python-lxml-debugsource-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python-lxml-debugsource-4.5.2-4.oe1.x86_64.rpm</FullProductName>
			<FullProductName ProductID="python2-lxml-4.5.2-4" CPE="cpe:/a:openEuler:openEuler:20.03-LTS-SP3">python2-lxml-4.5.2-4.oe1.x86_64.rpm</FullProductName>
		</Branch>
	</ProductTree>
	<Vulnerability Ordinal="1" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="1" xml:lang="en">lxml is a library for processing XML and HTML in the Python language. Prior to version 4.6.5, the HTML Cleaner in lxml.html lets certain crafted script content pass through, as well as script content in SVG files embedded using data URIs. Users that employ the HTML cleaner in a security relevant context should upgrade to lxml 4.6.5 to receive a patch. There are no known workarounds available.</Note>
		</Notes>
		<ReleaseDate>2022-01-07</ReleaseDate>
		<CVE>CVE-2021-43818</CVE>
		<ProductStatuses>
			<Status Type="Fixed">
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
				<ProductID>openEuler-20.03-LTS-SP2</ProductID>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Status>
		</ProductStatuses>
		<Threats>
			<Threat Type="Impact">
				<Description>High</Description>
			</Threat>
		</Threats>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>7.1</BaseScore>
				<Vector>AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Vendor Fix">
				<Description>python-lxml security update</Description>
				<DATE>2022-01-07</DATE>
				<URL>https://www.openeuler.org/en/security/safety-bulletin/detail.html?id=openEuler-SA-2022-1482</URL>
			</Remediation>
		</Remediations>
	</Vulnerability>
</cvrfdoc>
```

#### 3.3.1.2ã€ä¸å—å½±å“cveä¿¡æ¯

- ä¸å—å½±å“cveä¿¡æ¯çš„æ–‡ä»¶æ ¼å¼ï¼ˆxmlï¼‰å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<cvrfdoc xmlns="http://www.icasi.org/CVRF/schema/cvrf/1.1" xmlns:cvrf="http://www.icasi.org/CVRF/schema/cvrf/1.1">
	<Vulnerability Ordinal="1" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="1" xml:lang="en">A flaw was found in OpenEXR s hufDecode functionality. This flaw allows an attacker who can pass a crafted file to be processed by OpenEXR, to trigger an undefined right shift error. The highest threat from this vulnerability is to system availability.</Note>
		</Notes>
		<CVE>CVE-2021-20304</CVE>
		<ProductStatuses>
			<Status Type="Unaffected">
				<ProductID>openEuler-22.03-LTS</ProductID>
			</Status>
		</ProductStatuses>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>5.3</BaseScore>
				<Vector>AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Unaffected">
				<Description>OpenEXR</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-22.03-LTS</ProductID>
			</Remediation>
		</Remediations>
	</Vulnerability>
	<Vulnerability Ordinal="2" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="2" xml:lang="en">The command-line argument parser in tcpdump before 4.99.0 has a buffer overflow in tcpdump.c:read_infile(). To trigger this vulnerability the attacker needs to create a 4GB file on the local filesystem and to specify the file name as the value of the -F command-line argument of tcpdump.</Note>
		</Notes>
		<CVE>CVE-2018-16301</CVE>
		<ProductStatuses>
			<Status Type="Unaffected">
				<ProductID>openEuler-22.03-LTS</ProductID>
			</Status>
		</ProductStatuses>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>7.8</BaseScore>
				<Vector>AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Unaffected">
				<Description>tcpdump</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-22.03-LTS</ProductID>
			</Remediation>
		</Remediations>
	</Vulnerability>
	<Vulnerability Ordinal="3" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="3" xml:lang="en">No description is available for this CVE.</Note>
		</Notes>
		<CVE>CVE-2021-23980</CVE>
		<ProductStatuses>
			<Status Type="Unaffected">
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Status>
		</ProductStatuses>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>6.1</BaseScore>
				<Vector>AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Unaffected">
				<Description>python-bleach</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
			</Remediation>
			<Remediation Type="Unaffected">
				<Description>python-bleach</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Remediation>
		</Remediations>
	</Vulnerability>
	<Vulnerability Ordinal="4" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="4" xml:lang="en">Use after free in garbage collector and finalizer of lgc.c in Lua interpreter 5.4.0~5.4.3 allows attackers to perform Sandbox Escape via a crafted script file.</Note>
		</Notes>
		<CVE>CVE-2021-44964</CVE>
		<ProductStatuses>
			<Status Type="Unaffected">
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Status>
		</ProductStatuses>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>6.3</BaseScore>
				<Vector>AV:L/AC:L/PR:N/UI:R/S:C/C:N/I:N/A:H</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Unaffected">
				<Description>lua</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
			</Remediation>
			<Remediation Type="Unaffected">
				<Description>lua</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Remediation>
		</Remediations>
	</Vulnerability>
	<Vulnerability Ordinal="5" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="5" xml:lang="en">A double-free condition exists in contrib/shpsort.c of shapelib 1.5.0 and older releases. This issue may allow an attacker to cause a denial of service or have other unspecified impact via control over malloc.</Note>
		</Notes>
		<CVE>CVE-2022-0699</CVE>
		<ProductStatuses>
			<Status Type="Unaffected">
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Status>
		</ProductStatuses>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>5</BaseScore>
				<Vector>AV:N/AC:L/Au:N/C:P/I:N/A:N</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Unaffected">
				<Description>shapelib</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
			</Remediation>
			<Remediation Type="Unaffected">
				<Description>shapelib</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Remediation>
		</Remediations>
	</Vulnerability>
	<Vulnerability Ordinal="6" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="6" xml:lang="en">Improper Input Validation vulnerability in HTTP/2 header parsing of Apache Traffic Server allows an attacker to smuggle requests. This issue affects Apache Traffic Server 8.0.0 to 9.1.2.</Note>
		</Notes>
		<CVE>CVE-2022-31779</CVE>
		<ProductStatuses>
			<Status Type="Unaffected">
				<ProductID>openEuler-22.03-LTS</ProductID>
			</Status>
		</ProductStatuses>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>7.5</BaseScore>
				<Vector>AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Unaffected">
				<Description>trafficserver</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-22.03-LTS</ProductID>
			</Remediation>
		</Remediations>
	</Vulnerability>
	<Vulnerability Ordinal="7" xmlns="http://www.icasi.org/CVRF/schema/vuln/1.1">
		<Notes>
			<Note Title="Vulnerability Description" Type="General" Ordinal="7" xml:lang="en">In Varnish Cache 7.0.0, 7.0.1, 7.0.2, and 7.1.0, it is possible to cause the Varnish Server to assert and automatically restart through forged HTTP/1 backend responses. An attack uses a crafted reason phrase of the backend response status line. This is fixed in 7.0.3 and 7.1.1.</Note>
		</Notes>
		<CVE>CVE-2022-38150</CVE>
		<ProductStatuses>
			<Status Type="Unaffected">
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Status>
		</ProductStatuses>
		<CVSSScoreSets>
			<ScoreSet>
				<BaseScore>7.5</BaseScore>
				<Vector>AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H</Vector>
			</ScoreSet>
		</CVSSScoreSets>
		<Remediations>
			<Remediation Type="Unaffected">
				<Description>varnish</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP1</ProductID>
			</Remediation>
			<Remediation Type="Unaffected">
				<Description>varnish</Description>
				<DATE>2022-08-29</DATE>
				<ProductID>openEuler-20.03-LTS-SP3</ProductID>
			</Remediation>
		</Remediations>
	</Vulnerability>
</cvrfdoc>
```

- è§£æåcveçš„è¯„åˆ†ã€ä¸¥é‡ç¨‹åº¦ã€å‘å¸ƒæ—¶é—´ç­‰å­˜å…¥mysqlä¸­ï¼Œcveçš„æè¿°ä¿¡æ¯å­˜å…¥elasticsearchï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š

```json
index:cve_pkg

{
    "cve_id": "",
    "description": ""
}
```

### 3.2.2ã€cveä¿¡æ¯å¯¼å‡º



### 3.2.3ã€cveè¯„å®¡çŠ¶æ€è®¾ç½®

æ”¯æŒç”¨æˆ·ä¿®æ”¹cveçŠ¶æ€ï¼Œç›®å‰æ”¯æŒçŠ¶æ€ä¸ºï¼š

- not reviewedï¼ˆæœªå…³æ³¨ï¼‰
- in reviewï¼ˆå…³æ³¨ä¸­ï¼‰
- on-holdï¼ˆæŒ‚èµ·ï¼‰
- resolvedï¼ˆå·²è§£å†³ï¼‰
- no actionï¼ˆå·²å¿½ç•¥ï¼‰

## 3.3ã€ä»»åŠ¡ç®¡ç†

ä»»åŠ¡ç®¡ç†æ¨¡å—æä¾›åŠŸèƒ½ï¼šrepoæºè®¾ç½®ã€cveæ‰«æã€cveä¿®å¤ç­‰ä»»åŠ¡çš„åˆ›å»ºã€ä»»åŠ¡è¿›åº¦æŸ¥è¯¢/å›è°ƒåŠŸèƒ½

- ä»»åŠ¡ç®¡ç†å®šä¹‰äº†ä¸€å¥—è§„èŒƒï¼Œç”±manageræ§åˆ¶ï¼š
  - ä»»åŠ¡åˆ›å»ºï¼ˆcreate_taskï¼‰
  - å‰ç½®æ“ä½œï¼ˆpre_handleï¼‰ï¼Œä¸»è¦æ˜¯æ•°æ®åº“é‡Œä¸€äº›ç›¸åº”çŠ¶æ€çš„ä¿®æ”¹ï¼Œ
  - ä»»åŠ¡æ‰§è¡Œï¼ˆhandleï¼‰ï¼Œè¿™é‡Œçš„ä»»åŠ¡æ‰§è¡Œä¸»è¦é€šè¿‡å‘aops-zeuså‘é€restfulè¯·æ±‚è¿›è¡Œï¼Œaops-zeusæ ¡éªŒåä¼šå†å‘å®¢æˆ·ç«¯å‘é€å‘½ä»¤æ‰§è¡Œè¯·æ±‚ã€‚
  - å›è°ƒï¼ˆcallbackï¼‰ï¼Œä¸ºå®æ—¶åé¦ˆä»»åŠ¡è¿›åº¦ï¼Œrestfulè¯·æ±‚ä¸­å¸¦äº†å›è°ƒå‡½æ•°åœ°å€ï¼Œæ¯å½“ä¸€ä¸ªå­ä»»åŠ¡å®Œæˆï¼Œä¼šé€šè¿‡å›è°ƒå‡½æ•°å®æ—¶æ›´æ–°ä»»åŠ¡çŠ¶æ€ã€‚
  - ä»»åŠ¡åç½®å¤„ç†ï¼ˆpost_handleï¼‰ï¼Œä¸»è¦å°†ä»»åŠ¡ç»“æœç»è¿‡å¤„ç†ååˆ·æ–°åˆ°æ•°æ®åº“ä¸­ã€‚
  - é”™è¯¯å¤„ç†ï¼ˆfault_handleï¼‰ï¼Œä¸ºé˜²æ­¢ç½‘ç»œåŸå› ç­‰é—®é¢˜å¯¼è‡´ä»»åŠ¡è¿›åº¦åˆ·æ–°å¤±è´¥ã€ä»»åŠ¡æ‰§è¡Œå¤±è´¥ç­‰ï¼Œéœ€è¦å†å°†æ•°æ®åº“ä¸­çš„çŠ¶æ€åˆ·æ–°ã€‚

- æµç¨‹å›¾

![å®šæ—¶ä»»åŠ¡ç®¡ç†](pic/ä»»åŠ¡ç®¡ç†æµç¨‹å›¾.png)

- æ—¶åºå›¾

![ä»»åŠ¡ç®¡ç†)](pic/ä»»åŠ¡ç®¡ç†-æ—¶åºå›¾.png)

#### 3.3.1ã€repoæºè®¾ç½®

- create_task
  
  - å°†ä»»åŠ¡ä¿¡æ¯å­˜å…¥æ•°æ®åº“ï¼Œè¯¥ä»»åŠ¡ä¸»è¦æ˜¯å°†repoæºä¸‹å‘åˆ°å®¢æˆ·ç«¯æŒ‡å®šè·¯å¾„
  
  - ç”Ÿæˆä»»åŠ¡ä¿¡æ¯ï¼ˆä¸aops-ceresæœåŠ¡çº¦å®šä»»åŠ¡æ¨¡æ¿ï¼‰
  
    ```json
    {
        "task_id": "1",
        "task_name": "",
        "task_type": "repo set",
        "total_hosts": ["id1", "id2"],
        // ä¸€äº›é¢„ç½®æ£€æŸ¥éœ€è¦ï¼Œå¦‚æ£€æŸ¥ç½‘ç»œç­‰ï¼Œå½“æ£€æŸ¥å¤±è´¥æ—¶ï¼Œåœæ­¢æ‰§è¡Œä»»åŠ¡
        "check_items": [],
        "repo_info": {
            // repoåç§°
            "name": "",
            // å­˜æ”¾è·¯å¾„
            "dest": "/etc/yum.repos.d/aops-update.repo",
            // repoå†…å®¹ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼å‘ˆç°
            "repo_content": ""
        },
        "tasks": [
            {
                "host_id": "id1",
                // æ˜¯å¦æ‰§è¡Œé¢„ç½®æ£€æŸ¥
                "check": false
            },
            {
                "host_id": "id2",
                "check": false
            }
        ],
        "callback": "/vulnerability/task/callback/repo/set"
    }
    ```
  
- pre_handle
  
  - æ›´æ–°repoè®¾ç½®ä»»åŠ¡çš„çŠ¶æ€ä¸º`running`
  - æ›´æ–°ä»»åŠ¡æ‰§è¡Œæ—¶é—´ä¸ºå½“å‰æ—¶é—´
  
- handle

  - å‘aops-zeuså‘é€restfulè¯·æ±‚
  - å›è°ƒå‡½æ•°åœ°å€ï¼š/vulnerability/task/callback/repo/set

- callback

  - callback_on_okï¼šæ›´æ–°repoä»»åŠ¡ç›¸åº”ä¸»æœºçš„statusä¸º`set`ï¼Œæ›´æ–°è¯¥ä¸»æœºçš„repo_nameä¸ºå½“å‰è®¾ç½®repo
  - callback_on_failedï¼šæ›´æ–°repoä»»åŠ¡ç›¸åº”ä¸»æœºçš„statusä¸º`unset`

- post_handle

  - åˆå¹¶æ‰€æœ‰ä¸»æœºçš„ç»“æœï¼Œå­˜å‚¨ï¼ˆåŒ…å«æ‰§è¡Œæ—¥å¿—ï¼‰åˆ°æ•°æ®åº“ä¸­

    ```json
    {
        "task_id": "1",
        "task_name": "",
        "task_type": "repo set",
        "latest_execute_time": 111,
        "task_result": [
            {
                "host_id": "",
                "host_name": "",
                "host_ip": "",
                // repoåç§°
                "repo": "",
                // è¯¥ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¯ä¸ºsucceedï¼Œfailï¼Œunknown
                "status": "succeed",
                "check_items": [
                    {
                        "item": "network",
                        "result": true
                    }
                ],
                "log": ""
            }
        ]
    }
    ```

- fault_handle

  - è®¾ç½®çŠ¶æ€è¿˜åœ¨è¿è¡Œä¸­çš„ä¸»æœºä¸º`unknown`

#### 3.3.2ã€cveæ‰«æ

- create_task

  - è¯¥ä»»åŠ¡ä¸»è¦æ˜¯å¯¹æŒ‡å®šä¸»æœºè¿›è¡Œæ‰«æï¼Œåœ¨é…ç½®updateçš„repoæºåï¼Œæ‰§è¡Œyum updateinfo list cves installedï¼Œå³å¯å¾—åˆ°è¯¥ä¸»æœºå·²å®‰è£…è½¯ä»¶çš„æœªä¿®å¤cveåˆ—è¡¨

  - ç”Ÿæˆä»»åŠ¡ä¿¡æ¯ï¼ˆä¸aops-ceresæœåŠ¡çº¦å®šä»»åŠ¡æ¨¡æ¿ï¼‰

    ```json
    {
        "task_id": "",
        "task_name": "",
        "task_type": "cve scan",
        "total_hosts": ["id1", "id2"],
        // ä¸€äº›é¢„ç½®æ£€æŸ¥éœ€è¦ï¼Œå¦‚æ£€æŸ¥repoæºæ˜¯å¦å·²é…ç½®
        "check_items": [],
        // ä¸å—å½±å“çš„cve
        "unaffected_cves": {
            "cve1": {
                // è¡¨ç¤ºåœ¨å“ªä¸ªç‰ˆæœ¬
                "os_version": [],
                // ç›¸åº”çš„è½¯ä»¶åŒ…
                "package": []
            }
        },
        "tasks": [
            {
                "host_id": "id1",
                // æ˜¯å¦æ‰§è¡Œé¢„ç½®æ£€æŸ¥
                "check": false
            },
            {
                "host_id": "id2",
                "check": false
            }
        ],
        "callback": "/vulnerability/task/callback/cve/scan"
    }
    ```

- pre_handle

  - æ›´æ–°ä¸»æœºçš„çŠ¶æ€ä¸º`scanning`

- handle

  - å‘aops-zeuså‘é€restfulè¯·æ±‚
  - å›è°ƒå‡½æ•°åœ°å€ï¼š/vulnerability/task/callback/cve/scan

- callback

  - ä¿®æ”¹ä¸»æœºçŠ¶æ€ä¸º`done`

- post_handle

  - åˆå¹¶æ‰€æœ‰ä¸»æœºçš„ç»“æœï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ä¸­

    ```json
    {
        "task_id": "",
        "task_name": "",
        "task_type": "cve scan",
        "latest_execute_time": 111,
        "task_result": [
            {
                "host_id": "",
                "host_name": "",
                "host_ip": "",
                // è¯¥ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¯ä¸ºsucceedï¼Œfailï¼Œunknown
                "status": "succeed",
                "check_items": [
                    {
                        "item": "network",
                        "result": true
                    }
                ],
                "affected_cves": ["cve1", "cve2"],
                "unaffected_cves": ["cve3"],
                "log": ""
            }
        ]
    }
    ```

- fault_handle

  - è®¾ç½®çŠ¶æ€è¿˜åœ¨æ‰«æä¸­çš„ä¸»æœºä¸º`done`

#### 3.3.3ã€cveä¿®å¤

- create_task

  - è¯¥ä»»åŠ¡ä¸»è¦æ˜¯å¯¹æŒ‡å®šä¸»æœºçš„æŒ‡å®šcveè¿›è¡Œä¿®å¤ï¼Œåœ¨é…ç½®updateçš„repoæºåï¼Œæ‰§è¡Œyum update --cve cve_idå®Œæˆè¯¥cveçš„ä¿®å¤

  - ç”Ÿæˆä»»åŠ¡ä¿¡æ¯ï¼ˆä¸aops-ceresæœåŠ¡çº¦å®šä»»åŠ¡æ¨¡æ¿ï¼‰

    ```json
    {
        "task_id": "2",
        "task_name": "",
        "task_type": "cve fix",
        "total_hosts": ["id1", "id2"],
        // ä¸€äº›é¢„ç½®æ£€æŸ¥éœ€è¦ï¼Œå¦‚æ£€æŸ¥repoæºæ˜¯å¦å·²é…ç½®
        "check_items": ["network"],
        "tasks": [
            {
                "host_id": "id1",
                // æ˜¯å¦æ‰§è¡Œé¢„ç½®æ£€æŸ¥
                "check": true,
                "cves": ["cve1", "cve2"]
            },
            {
                "host_id": "id2",
                "check": true,
                "cves": ["cve1"]
            }
        ],
        "callback": "/vulnerability/task/callback/cve/fix"
    }
    ```

- pre_handle

  - æ›´æ–°ä¸»æœºçš„çŠ¶æ€ä¸º`running`ï¼Œä¿®æ”¹è¿›åº¦ä¸º0
  - æ›´æ–°ä»»åŠ¡æ‰§è¡Œæ—¶é—´ä¸ºå½“å‰æ—¶é—´

- handle

  - å‘aops-zeuså‘é€restfulè¯·æ±‚
  - å›è°ƒå‡½æ•°åœ°å€ï¼š/vulnerability/task/callback/cve/fix

- callback

  - callback_on_okï¼šæ›´æ–°cveä¿®å¤ä»»åŠ¡ç›¸åº”ä¸»æœºç›¸åº”cveçš„statusä¸º`fixed`ï¼Œæ›´æ–°è¿™äº›ä¿®å¤cveçš„è¿›åº¦
  - callback_on_failedï¼šæ›´æ–°cveä¿®å¤ä»»åŠ¡ç›¸åº”ä¸»æœºç›¸åº”cveçš„statusä¸º`unfixed`

- post_handle

  - åˆå¹¶æ‰€æœ‰ä¸»æœºçš„ç»“æœï¼Œå­˜å‚¨ï¼ˆåŒ…å«æ‰§è¡Œæ—¥å¿—ï¼‰åˆ°æ•°æ®åº“ä¸­

    ```json
    {
        "task_id": "2",
        "task_name": "",
        "task_type": "cve_fix",
        "latest_execute_time": 111,
        "task_result": [
            {
                "host_id": "",
                "host_name": "",
                "host_ip": "",
                // è¯¥ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¯ä¸ºsucceedï¼Œfailï¼Œunknown
                "status": "fail",
                "check_items": [
                    {
                        "item": "network",
                        "result": true
                    }
                ],
                "cves": [
                    {
                        "cve_id": "cve1",
                        "log": "",
                        "result": "unfixed"
                    },
                    {
                        "cve_id": "cve2",
                        "log": "",
                        "result": "fixed"
                    }
                ]
            }
        ]
    }
    ```

- fault_handle

  - è®¾ç½®çŠ¶æ€è¿˜åœ¨è¿è¡Œä¸­çš„ä¸»æœºçš„çŠ¶æ€ä¸º`unknown`
  - è¡¥é½ä¿®å¤cveä»»åŠ¡çš„è¿›åº¦

# 4ã€è´¨é‡å±æ€§è®¾è®¡

## 4.1ã€æ€§èƒ½è§„æ ¼

| è§„æ ¼åç§° | è§„æ ¼æŒ‡æ ‡                 |
| :------- | :----------------------- |
| å†…å­˜å ç”¨ | æœåŠ¡å ç”¨å†…å­˜æ­£åœ¨100Må†…ã€‚ |
| å¯åŠ¨æ—¶é—´ | 3så†…å¯åŠ¨                 |
| å“åº”æ—¶é—´ | 1-2ç§’å†…ç»™å‡ºå“åº”ã€‚        |

## 4.2ã€å¯é æ€§è®¾è®¡

**1.å¼‚å¸¸æƒ…å†µ**

è¯¥æœåŠ¡ä½¿ç”¨systemdç®¡ç†ï¼Œå½“æœåŠ¡å¼‚å¸¸ç»ˆæ­¢æ—¶å‡å¯è¢«é‡æ–°å¯åŠ¨ã€‚

**2.æ•°æ®åº“**
ç³»ç»Ÿå¢åŠ å®šæ—¶ä»»åŠ¡ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´æ®µå†…ï¼Œå¯¹ç³»ç»Ÿä¸­çš„æ•°æ®åšå¤‡ä»½ï¼Œé»˜è®¤ä¿ç•™æœ€è¿‘1å‘¨çš„æ•°æ®ï¼Œä¾¿äºåæœŸæ¢å¤ï¼Œè¯¥å‘¨æœŸå¯é…ç½® ã€‚

## 4.3ã€å®‰å…¨æ€§è®¾è®¡

**1.æ•°æ®åº“æƒé™**
æ•°æ®åº“ç»Ÿä¸€å¯¹ç”¨æˆ·è¿›è¡Œäº†åŒºåˆ†ï¼Œå³ç”¨æˆ·åªèƒ½è®¿é—®å…¶ç›¸å…³ä¸»æœºçš„ä¿¡æ¯ã€‚

**2.ç”¨æˆ·æƒé™é—®é¢˜**

ç”¨æˆ·éœ€è¦ç™»å½•åè·å–åˆ°tokenï¼Œåç»­é€šè¿‡tokenæ¥è°ƒç”¨è¯¥æœåŠ¡çš„æ¥å£ï¼ŒåŒ…æ‹¬repoä¿¡æ¯ç®¡ç†ã€cveç®¡ç†ã€ä»»åŠ¡ç®¡ç†ç­‰ï¼Œéƒ½ä¸è¯¥ç™»å½•ç”¨æˆ·å…³è”ã€‚ç”¨æˆ·ä¹Ÿä¼šé€šè¿‡ç™»å½•çš„tokenåƒmanageræœåŠ¡è·å–åˆ°å±äºè‡ªå·±çš„ä¸»æœºï¼Œä¸å…·å¤‡è®¿é—®å…¶ä»–ç”¨æˆ·ä¸»æœºçš„æƒé™ã€‚

**3.æ–‡ä»¶æƒé™é—®é¢˜**

 é‡‡ç”¨æƒé™æœ€å°åŒ–ç­–ç•¥ï¼Œä»£ç å¼€å‘å®Œæˆåè¡¥å……ç›¸å…³æ–‡ä»¶çš„æƒé™è®¾è®¡ã€‚

**4.restfulæ¥å£å®‰å…¨**

å‘é€è¯·æ±‚æ—¶ä½¿ç”¨tokenè¿›è¡Œèº«ä»½éªŒè¯ï¼Œåç«¯æ¥æ”¶è¯·æ±‚åå¯¹æ¥å£å‚æ•°åšæ¯ä¸ªå‚æ•°ç±»å‹çš„æ ¡éªŒã€‚

**5.å‘½ä»¤æ³¨å…¥é—®é¢˜**

å‘½ä»¤è¡Œæ“ä½œï¼Œå…¥å‚ä¼šåšæ ¡éªŒï¼Œè€Œä¸”åå°ä¸ºè§£æå‚æ•°åè°ƒç”¨urlæ¥å£ï¼Œä¸å­˜åœ¨å…¥å‚æ‹¼æ¥å‘½ä»¤æ‰§è¡Œæ“ä½œï¼Œæ‰€ä»¥ä¸å­˜åœ¨å‘½ä»¤æ³¨å…¥é—®é¢˜ã€‚

## 4.4ã€å…¼å®¹æ€§è®¾è®¡

1.æœåŠ¡å¯¹å¤–æ¥å£ä½¿ç”¨restfulæ¥å£ï¼Œå¯¹å¤–æ¥å£åªèƒ½å¢é‡å˜åŒ–ï¼Œæ–°ç‰ˆæœ¬ä¿è¯æ—§ç‰ˆæœ¬æ¥å£å¯ç”¨ã€‚

2.å¯¹äºåº•å±‚ç¼“å­˜ï¼Œæ•°æ®åº“çš„å˜æ›´ï¼Œå¯¹å¤–ä¸ä½“ç°ï¼Œç”±ä»£ç é€»è¾‘ä¿è¯å¯ç”¨æ€§ã€‚

## 4.5ã€å¯æœåŠ¡æ€§è®¾è®¡

å¾…è€ƒè™‘

## 4.6ã€å¯æµ‹è¯•æ€§è®¾è®¡

å¾…è€ƒè™‘

# 5ã€å¤–éƒ¨æ¥å£æ¸…å•

[aops-apolloæ¥å£æ–‡æ¡£.yaml](aops-apolloæ¥å£æ–‡æ¡£.yaml)

# 6ã€æ•°æ®åº“è®¾è®¡
[aops-apolloæ•°æ®åº“è®¾è®¡.sql](aops-apolloæ•°æ®åº“è®¾è®¡.sql)

# 7ã€ä¿®æ”¹æ—¥å¿—

| ç‰ˆæœ¬ | å‘å¸ƒè¯´æ˜             | ä¿®æ”¹äºº|
| :--- | :-------------------|:-----|
| 1.0  | åˆç¨¿ï¼Œå®Œéƒ¨åˆ†æ¨¡å—è®¾è®¡ |æœ±è¿æˆ|
| 2.0  | ä»»åŠ¡ç®¡ç†æ¨¡å—é‡æ„     |xxx|
| 3.0  | æ–°å¢çƒ­è¡¥ä¸æ”¯æŒï¼Œåˆç¨¿ |solarhu|
| 3.1  | æ›´æ–°çƒ­è¡¥ä¸æ”¯æŒæ¥å£æè¿°|solarhu|


# 8ã€å‚è€ƒç›®å½•
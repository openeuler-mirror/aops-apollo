swagger: '2.0'
info:
  version: v1
  title: apollo
  description: cve manager
schemes:
  - https
host: localhost.com
basePath: /vulnerability
tags:
  - name: repo
  - name: cve
  - name: host
  - name: task
paths:
  /repo/import:
    post:
      tags:
        - repo
      summary: 添加repo源
      description: 添加repo源
      operationId: import_repo
      produces:
        - application/json
      parameters:
        - in: body
          name: repo_info
          description: repo信息
          required: true
          schema:
            $ref: '#/definitions/RepoImportReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /repo/get:
    post:
      tags:
        - repo
      description: 获取repo源
      summary: 获取repo源
      operationId: get_repo
      produces:
        - application/json
      parameters:
        - in: body
          name: repo_name_list
          description: ''
          required: true
          schema:
            $ref: '#/definitions/RepoGetReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/RepoGetRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /repo/delete:
    delete:
      tags:
        - repo
      description: 删除repo源
      summary: 删除repo源
      operationId: delete_repo
      produces:
        - application/json
      parameters:
        - in: body
          name: repo_name_list
          description: ''
          required: true
          schema:
            $ref: '#/definitions/RepoDeleteReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/RepoDeleteRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /repo/update:
    post:
      tags:
        - repo
      summary: 更新repo源
      deprecated: true
      operationId: update_repo
      parameters:
        - name: param
          in: body
          required: false
          schema:
            $ref: '#/definitions/RepoImportReq'
        - name: access_token
          in: header
          required: false
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
  /repo/template/get:
    get:
      tags:
        - repo
      summary: 获取repo模板文件
      operationId: get_repo_template
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GetRepoTemplateRsp'
  /cve/overview:
    get:
      tags:
        - cve
      description: 查看各级别cve的数量
      summary: 查看各级别cve的数量
      operationId: query_cve_overview
      produces:
        - application/json
      parameters:
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryOverviewRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/list/get:
    post:
      tags:
        - cve
      description: |-
        获取CVE列表
        fix：查询的时候根据affected进行筛选
      summary: 获取CVE列表
      operationId: query_cve_list
      produces:
        - application/json
      parameters:
        - in: body
          name: query_conditions
          description: 查询条件
          schema:
            $ref: '#/definitions/QueryCveListReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveListRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/info/get:
    get:
      tags:
        - cve
      description: 获取某CVE详细信息
      summary: 获取某CVE详细信息
      operationId: query_cve_info
      produces:
        - application/json
      parameters:
        - in: body
          name: cve_id
          description: ''
          schema:
            $ref: '#/definitions/QueryCveInfoReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveInfoRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/host/get:
    post:
      tags:
        - cve
      description: 获取某cve主机相关详细信息
      summary: 获取某cve主机相关详细信息
      operationId: query_cve_host
      produces:
        - application/json
      parameters:
        - in: body
          name: query_conditions
          description: 查询条件
          schema:
            $ref: '#/definitions/QueryCveHostReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveHostRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/task/host/get:
    post:
      tags:
        - cve
      description: 获取多个cve对应的主机基本信息（id, ip, name）
      summary: 获取多个cve对应的主机基本信息（id, ip, name）
      operationId: query_cve_task_host
      produces:
        - application/json
      parameters:
        - in: body
          name: cve_id_list
          description: cve id 列表，不为空
          schema:
            $ref: '#/definitions/QueryCveTaskHostReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveTaskHostRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/status/set:
    post:
      tags:
        - cve
      description: 设置cve状态
      summary: 设置cve状态
      operationId: set_cve_status
      deprecated: true
      produces:
        - application/json
      parameters:
        - in: body
          name: cve_list_with_status
          description: cve id 列表与拟修改状态
          schema:
            $ref: '#/definitions/SetCveStatusReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/action/query:
    post:
      tags:
        - cve
      description: 查询修复cve后的一系列操作
      summary: 查询修复cve后的一系列操作
      operationId: query_cve_action
      produces:
        - application/json
      parameters:
        - in: body
          name: cve_id_list
          description: cve id 列表
          schema:
            $ref: '#/definitions/QueryCveActionReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveActionRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/advisory/upload:
    post:
      tags:
        - cve
      description: |-
        安全公告导入
        feature：支持另一文件的解析和导入
      summary: 安全公告导入
      operationId: upload_cve_advisory
      consumes:
        - multipart/form-data
      produces:
        - multipart/form-data
      parameters:
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
        - name: file
          in: formData
          required: false
          type: file
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/unaffected/upload:
    post:
      tags:
        - cve
      description: |-
        安全公告导入
        feature：支持不受影响cve文件的解析和导入
      summary: 不受影响cve导入
      operationId: upload_cve_unaffected
      consumes:
        - multipart/form-data
      produces:
        - multipart/form-data
      parameters:
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
        - name: file
          in: formData
          required: false
          type: file
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /cve/info/export:
    post:
      tags:
        - cve
      summary: 导出cve信息
      description: 导出cve信息
      operationId: export_cve
      parameters:
        - name: req
          in: body
          required: true
          schema:
            $ref: '#/definitions/ExportCveReq'
        - name: access_token
          in: header
          required: false
          type: string
      responses:
        '200':
          description: ''
          schema:
            type: file
  /host/status/get:
    post:
      tags:
        - host
      description: 查询主机的扫描状态
      summary: 查询主机的扫描状态
      operationId: query_host_status
      produces:
        - application/json
      parameters:
        - in: body
          name: host_list
          description: 主机id列表，为空表示所有
          schema:
            $ref: '#/definitions/QueryHostStatusReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryHostScanStatusRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /host/scan/status/get:
    post:
      tags:
        - host
      description: 查询主机的扫描状态
      summary: 查询主机的扫描状态
      operationId: query_host_scan_status
      deprecated: true
      produces:
        - application/json
      parameters:
        - in: body
          name: host_list
          description: 主机id列表，为空表示所有
          schema:
            $ref: '#/definitions/ScanHostReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryHostScanStatusRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /host/list/get:
    post:
      tags:
        - host
      description: |-
        获取主机列表
        feature：返回的cve_num字段要筛选受影响的cve
      summary: 获取主机列表
      operationId: query_host_list
      produces:
        - application/json
      parameters:
        - in: body
          name: query_conditions
          description: 查询条件
          schema:
            $ref: '#/definitions/QueryHostListReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryHostListRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /host/info/get:
    get:
      tags:
        - host
      description: |-
        获取主机的详细信息
        feature：同query_host_list接口
      summary: 获取主机的详细信息
      operationId: query_host_info
      produces:
        - application/json
      parameters:
        - in: body
          name: host_id
          description: 主机ID
          schema:
            $ref: '#/definitions/QueryHostInfoReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryHostInfoRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /host/cve/get:
    post:
      tags:
        - host
      description: |-
        获取指定主机的详细cve信息
        feature：增加筛选项：是否受影响
      summary: 获取指定主机的详细cve信息
      operationId: query_host_cve_info
      produces:
        - application/json
      parameters:
        - in: body
          name: query_conditions
          description: 查询条件
          schema:
            $ref: '#/definitions/QueryHostCveInfoReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryHostCveInfoRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /host/scan:
    post:
      tags:
        - task
      description: 扫描主机cve信息
      summary: 扫描主机cve信息
      operationId: scan_host
      produces:
        - application/json
      parameters:
        - in: body
          name: host_list
          description: 主机id列表，为空表示所有
          schema:
            $ref: '#/definitions/ScanHostReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 0
  /task/list/get:
    post:
      tags:
        - task
      description: |-
        获取任务的列表
        feature：各任务类型字段做了修改，从原来的cve/repo更改为cve fix,  repo set
      summary: 获取漏洞修复任务及设置repo任务的列表
      operationId: query_task_list
      produces:
        - application/json
      parameters:
        - in: body
          name: query_conditions
          description: 查询条件
          schema:
            $ref: '#/definitions/QueryTaskListReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryTaskListRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 1
  /task/progress/get:
    post:
      tags:
        - task
      description: 获取任务的最新进度
      summary: 获取任务的最新进度
      operationId: query_task_progress
      produces:
        - application/json
      parameters:
        - in: body
          name: task_list
          description: 任务ID列表,非空
          schema:
            $ref: '#/definitions/QueryTaskProgressReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryTaskProgressRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 2
  /task/info/get:
    get:
      tags:
        - task
      description: 获取任务的基础信息
      summary: 获取任务的基础信息
      operationId: query_task_info
      produces:
        - application/json
      parameters:
        - in: body
          name: task_id
          description: 任务ID
          schema:
            $ref: '#/definitions/QueryTaskInfoReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryTaskInfoRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 3
  /task/cve/generate:
    post:
      tags:
        - task
      description: |-
        生成漏洞修复任务
        fix:任务信息重构
      summary: 生成漏洞修复任务
      operationId: generate_cve_fix_task
      produces:
        - application/json
      parameters:
        - in: body
          name: task_info
          schema:
            $ref: '#/definitions/GenerateCveTaskReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GenerateCveTaskRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 4
  /task/cve/info/get:
    post:
      tags:
        - task
      description: 获取cve任务的详细信息
      summary: 获取cve任务的详细信息
      operationId: query_cve_task_info
      produces:
        - application/json
      parameters:
        - in: body
          name: query_conditions
          description: 查询条件
          schema:
            $ref: '#/definitions/QueryCveTaskInfoReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveTaskInfoRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 5
  /task/cve/status/get:
    post:
      tags:
        - task
      description: 获取cve修复任务主机的状态
      summary: 获取cve修复任务主机的状态
      operationId: query_cve_task_status
      produces:
        - application/json
      parameters:
        - in: body
          name: task_id_with_cve_list
          description: 任务ID与CVE列表
          schema:
            $ref: '#/definitions/QueryCveTaskStatusReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveTaskStatusRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 6
  /task/cve/progress/get:
    get:
      tags:
        - task
      description: 获取cve修复任务的最新进度
      summary: 获取cve修复任务的最新进度
      operationId: query_cve_task_progress
      produces:
        - application/json
      parameters:
        - in: body
          name: task_id_with_cve_list
          description: 任务ID与CVE列表
          schema:
            $ref: '#/definitions/QueryCveTaskStatusReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveTaskProgressRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 7
  /task/cve/result/get:
    post:
      tags:
        - task
      description: 获取cve修复任务的最新结果
      summary: 获取cve修复任务的最新结果
      operationId: query_cve_task_result
      produces:
        - application/json
      parameters:
        - in: body
          name: task_id_with_cve_list
          description: 任务ID与CVE列表
          schema:
            $ref: '#/definitions/QueryCveTaskStatusReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryCveTaskResultRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 8
  /task/cve/rollback:
    post:
      tags:
        - task
      description: 回退cve修复任务
      summary: 回退cve修复任务
      operationId: rollback_cve_task
      produces:
        - application/json
      deprecated: true
      parameters:
        - in: body
          name: task_id_with_cve_list
          description: 任务ID与CVE列表
          schema:
            $ref: '#/definitions/QueryCveTaskStatusReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/RollbackCveTaskRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 9
  /task/repo/generate:
    post:
      tags:
        - task
      description: |-
        创建设置指定主机的update repo源的任务
        fix: 修改：不再生成pb
      summary: 创建设置指定主机的update repo源的任务
      operationId: generate_repo_set_task
      produces:
        - application/json
      parameters:
        - in: body
          name: task_info
          description: 任务信息
          schema:
            $ref: '#/definitions/GenerateUpdateRepoTaskReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GenerateUpdateRepoTaskRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 10
  /task/repo/info/get:
    post:
      tags:
        - task
      description: 获取repo设置任务的详细信息
      summary: 获取repo设置任务的详细信息
      operationId: query_repo_set_task_info
      produces:
        - application/json
      parameters:
        - in: body
          name: query_conditions
          description: 查询条件
          schema:
            $ref: '#/definitions/QueryRepoSetTaskInfoReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryRepoSetTaskInfoRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 11
  /task/repo/result/get:
    post:
      tags:
        - task
      description: 获取repo设置任务的最新结果
      summary: 获取repo设置任务的最新结果
      operationId: query_repo_set_task_result
      produces:
        - application/json
      parameters:
        - in: body
          name: task_id_with_host_list
          description: 任务ID与主机ID列表
          schema:
            $ref: '#/definitions/QueryRepoSetTaskResultReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/QueryRepoSetTaskResultRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 12
  /task/execute:
    post:
      tags:
        - task
      description: |-
        执行任务
        feature:重构
      summary: 执行任务
      operationId: excute_task
      consumes:
        - application/x-www-form-urlencoded
      produces:
        - application/json
      parameters:
        - in: body
          name: task_id
          description: 任务ID
          schema:
            $ref: '#/definitions/ExecuteTaskReq'
        - in: header
          name: access_token
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 13
  /task/delete:
    delete:
      tags:
        - task
      description: |-
        删除任务
        feature:重构
      summary: 删除任务
      operationId: delete_task
      produces:
        - application/json
      parameters:
        - in: body
          name: task_list
          description: 任务列表
          schema:
            $ref: '#/definitions/DeleteTaskReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/DeleteTaskRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 14
  /task/playbook/get:
    get:
      tags:
        - task
      description: 获取任务的playbook
      summary: 获取任务的playbook
      operationId: query_task_plybook
      produces:
        - application/json
      deprecated: true
      parameters:
        - in: body
          name: task_info
          description: 任务ID与任务类型
          schema:
            $ref: '#/definitions/GetTaskPlaybookReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GetTaskPlaybookRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
      x-order: 15
  /task/callback/repo/set:
    post:
      tags:
        - task
      summary: 设置repo任务的回调
      description: 设置repo任务的回调
      operationId: callback_repo_set
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: repo_set_task_callback
          in: body
          required: false
          schema:
            $ref: '#/definitions/RepoSetCallbackReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
      x-order: 16
  /task/callback/cve/scan:
    post:
      tags:
        - task
      summary: cve扫描任务的回调
      description: cve扫描任务的回调
      operationId: callback_cve_scan
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: cve_scan_task_callback
          in: body
          required: false
          schema:
            $ref: '#/definitions/CveScanCallbackReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
      x-order: 17
  /task/callback/cve/fix:
    post:
      tags:
        - task
      summary: cve修复的任务回调
      description: cve修复的任务回调
      operationId: callback_cve_fix
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: cve_fix_task_callback
          in: body
          required: false
          schema:
            $ref: '#/definitions/CveFixCallbackReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
      x-order: 18
  /task/cve-rollback/generate:
    post:
      tags:
        - task
      description: |-
        生成漏洞回滚任务
      summary: 生成漏洞修复任务
      operationId: generate_cve_rollback_task
      produces:
        - application/json
      parameters:
        - in: body
          name: task_info
          schema:
            $ref: '#/definitions/GenerateRollbackTaskReq'
          required: false
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GenerateCveTaskRsp'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /task/callback/cve/rollback:
    post:
      tags:
        - task
      summary: cve修复的任务回调
      description: cve修复的任务回调
      operationId: callback_cve_rollback
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: cve_fix_task_callback
          in: body
          required: false
          schema:
            $ref: '#/definitions/CveRollbackCallbackReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GeneralRsp'
definitions:
  GetRepoTemplateRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: string
  CallbackCveFixReq:
    type: object
    properties:
      task_id:
        type: string
      host_id:
        type: string
      cves:
        type: object
        additionalProperties:
          type: string
        description: 'cve1: fixed'
  GetTaskPlaybookReq:
    required:
      - task_id
      - task_typ
    properties:
      task_id:
        type: string
        description: 任务ID
      task_type:
        type: string
        description: 任务类型
  GetTaskPlaybookRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: string
  DeleteTaskReq:
    required:
      - task_list
    properties:
      task_list:
        type: array
        items:
          type: string
        description: 任务id列表
  DeleteTaskRsp:
    allOf:
      - $ref: '#/definitions/ExecuteTaskRsp'
  ExecuteTaskReq:
    required:
      - task_id
    properties:
      task_id:
        type: string
        description: 任务id
  ExecuteTaskRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
  QueryRepoSetTaskResultReq:
    required:
      - task_id
      - host_list
    properties:
      task_id:
        type: string
      host_list:
        type: array
        items:
          type: integer
  QueryRepoSetTaskResultRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                properties:
                  task_id:
                    type: string
                  task_type:
                    type: string
                  latest_execute_time:
                    type: integer
                  task_result:
                    type: array
                    items:
                      properties:
                        host_id:
                          type: string
                        host_name:
                          type: string
                        host_ip:
                          type: string
                        status:
                          type: string
                        check_items:
                          type: array
                          items:
                            properties:
                              item:
                                type: string
                              result:
                                type: boolean
                        log:
                          type: string
  QueryRepoSetTaskInfoReq:
    required:
      - task_id
    properties:
      task_id:
        type: string
      page:
        type: integer
        format: int32
      per_page:
        type: integer
        format: int32
      filter:
        properties:
          host_name:
            type: string
          status:
            type: array
            items:
              type: string
            example:
              - succeed
              - fail
              - unkown
              - running
    type: object
  QueryRepoSetTaskInfoRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              total_count:
                type: integer
              total_page:
                type: integer
              result:
                type: array
                items:
                  type: object
                  properties:
                    host_id:
                      type: string
                    host_name:
                      type: string
                    host_ip:
                      type: string
                    repo_name:
                      type: string
                    status:
                      type: string
  GenerateUpdateRepoTaskReq:
    required:
      - task_name
      - description
      - repo_name
      - info
    properties:
      task_name:
        type: string
      description:
        type: string
      repo_name:
        type: string
      info:
        type: array
        items:
          properties:
            host_id:
              type: string
            host_name:
              type: string
            host_ip:
              type: string
      check_items:
        type: string
    type: object
  GenerateUpdateRepoTaskRsp:
    allOf:
      - $ref: '#/definitions/GenerateCveTaskRsp'
  RollbackCveTaskRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              succeed_list:
                type: array
                items:
                  type: string
                description: 执行成功列表
              fail_list:
                type: array
                items:
                  type: string
                description: 执行失败列表
  QueryCveTaskResultRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                properties:
                  task_id:
                    type: string
                  task_type:
                    type: string
                  latest_execute_time:
                    type: string
                  task_result:
                    type: array
                    items:
                      type: object
                      properties:
                        host_id:
                          type: string
                        host_name:
                          type: string
                        host_ip:
                          type: string
                        status:
                          type: string
                        check_items:
                          type: array
                          items:
                            type: object
                            properties:
                              item:
                                type: string
                              result:
                                type: boolean
                        cves:
                          type: array
                          items:
                            type: object
                            properties:
                              cve_id:
                                type: string
                              log:
                                type: string
                                description: 具体日志
                              result:
                                type: string
  QueryCveTaskProgressRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: array
                items:
                  type: object
                  additionalProperties:
                    properties:
                      cve_id:
                        type: string
                      progress:
                        type: integer
                      status:
                        type: string
  QueryCveTaskStatusReq:
    properties:
      task_id:
        type: string
        description: 任务ID
      cve_list:
        description: CVE列表
        type: array
        items:
          type: string
  QueryCveTaskStatusRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    host_id:
                      type: string
                    host_name:
                      type: string
                    host_ip:
                      type: string
                    status:
                      type: string
  QueryCveTaskInfoReq:
    required:
      - task_id
    properties:
      task_id:
        type: string
        description: 任务ID
      sort:
        type: string
        description: 可选host_num, 为空不排序
      direction:
        type: string
        description: 升序(asc)，降序(desc)，默认:asc
      page:
        type: integer
        description: 当前页码
      per_page:
        type: integer
        description: 每页数量,最大值50
      filter:
        type: object
        properties:
          cve_id:
            type: string
          reboot:
            type: boolean
          status:
            type: array
            items:
              type: string
            example:
              - fail
              - succeed
              - running
              - unknown
  QueryCveTaskInfoRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              total_count:
                type: integer
              total_page:
                type: integer
              result:
                type: array
                items:
                  properties:
                    cve_id:
                      type: string
                    package:
                      type: string
                    reboot:
                      type: boolean
                    host_num:
                      type: integer
                    status:
                      type: string
  GenerateCveTaskReq:
    required:
      - task_name
      - description
      - info
    properties:
      task_name:
        type: string
        description: 任务名称
      description:
        type: string
        description: 任务描述
      auto_reboot:
        type: boolean
        description: 默认为False
      check_items:
        type: string
        description: 任务描述
      info:
        type: array
        description: 需要修复的主机与cve的信息
        items:
          properties:
            cve_id:
              type: string
            host_info:
              type: array
              items:
                properties:
                  host_id:
                    type: integer
                    format: int32
                  host_name:
                    type: string
                  host_ip:
                    type: string
                  hotpatch:
                    type: boolean
            reboot:
              type: boolean
    type: object
  GenerateCveTaskRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              task_id:
                type: string
                description: 任务ID
  QueryTaskInfoReq:
    properties:
      task_id:
        type: string
        description: 任务id
  QueryTaskInfoRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                properties:
                  task_name:
                    type: string
                  description:
                    type: string
                  host_num:
                    type: integer
                  need_reboot:
                    type: integer
                  latest_execute_time:
                    type: integer
                  auto_reboot:
                    type: boolean
  QueryTaskProgressReq:
    properties:
      task_list:
        type: array
        items:
          type: string
        description: 任务id列表，不为空
  QueryTaskProgressRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                additionalProperties:
                  properties:
                    succeed:
                      type: integer
                    fail:
                      type: integer
                    running:
                      type: integer
                    unknown:
                      type: integer
  QueryTaskListReq:
    properties:
      sort:
        type: string
        description: 可选host_num、create_time, 为空不排序
      direction:
        type: string
        description: 升序(asc)，降序(desc)，默认:asc
      page:
        type: integer
        description: 当前页码
      per_page:
        type: integer
        description: 每页数量,最大值50
      filter:
        properties:
          task_name:
            type: string
            description: 可模糊搜索
          task_type:
            type: array
            items:
              type: string
            description: 可选cve rollback、cve fix、repo set
    type: object
  QueryTaskListRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              total_count:
                type: integer
              total_page:
                type: integer
              result:
                type: array
                items:
                  type: object
                  properties:
                    task_id:
                      type: string
                    task_name:
                      type: string
                    task_type:
                      type: string
                    description:
                      type: string
                    host_num:
                      type: integer
                    create_time:
                      type: integer
  QueryHostCveInfoReq:
    required:
      - host_id
    properties:
      host_id:
        type: string
      sort:
        type: string
        description: 可选publish_time、cvss_score
      direction:
        type: string
        description: 升序(asc)，降序(desc)，默认:asc
      page:
        type: integer
        description: 当前页码
      per_page:
        type: integer
        description: 每页数量,最大值50
      filter:
        properties:
          cve_id:
            type: string
          severity:
            type: array
            items:
              type: string
          affected:
            type: boolean
            description: 默认为True
          hotpatch:
            type: array
            items:
              type: boolean
          fixed:
            type: boolean
            description: CVE在具体主机的修复状态,默认为False
          hp_status:
            type: array
            items:
              type: string
              description: 已修复主机的热补丁状态，可选ACTIVED, ACCEPTED, 仅用于fixed为True的筛选
        required:
          - affected
    type: object
  QueryHostCveInfoRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            properties:
              total_count:
                type: integer
              total_page:
                type: integer
              result:
                type: array
                items:
                  properties:
                    cve_id:
                      type: string
                    publish_time:
                      type: string
                    severity:
                      type: string
                    description:
                      type: string
                    cvss_score:
                      type: string
                    status:
                      type: string
                    hotpatch:
                      type: boolean
  QueryHostInfoReq:
    properties:
      host_id:
        type: string
        description: 主机ID
  QueryHostInfoRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                properties:
                  host_name:
                    type: string
                  host_ip:
                    type: string
                  host_group:
                    type: string
                  repo:
                    type: string
                  affected_cve_num:
                    type: integer
                  unaffected_cve_num:
                    type: integer
                  fixed_cve_num:
                    type: integer
                  last_scan:
                    type: integer
  QueryHostListReq:
    properties:
      sort:
        type: string
        description: 可选last_scan、cve_num
      direction:
        type: string
        description: 升序(asc)，降序(desc)，默认:asc
      page:
        type: integer
        description: 当前页码
      per_page:
        type: integer
        description: 每页数量,最大值50
      filter:
        properties:
          host_name:
            type: string
            description: 可模糊搜索
          host_group:
            type: array
            items:
              type: string
          repo:
            type: array
            items:
              type: string
          status:
            type: array
            items:
              type: string
            example:
              - scanning
              - done
    type: object
  QueryHostListRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              total_count:
                type: integer
              total_page:
                type: integer
              result:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    host_id:
                      type: string
                    host_name:
                      type: string
                    host_ip:
                      type: string
                    host_group:
                      type: string
                    repo:
                      type: string
                    unfixed_cve_num:
                      type: integer
                    fixed_cve_num:
                      type: integer
                    last_scan:
                      type: integer
  QueryHostStatusReq:
    properties:
      host_list:
        type: array
        description: 主机id列表，为空表示所有
        items:
          type: integer
  ScanHostReq:
    properties:
      host_list:
        type: array
        description: 主机id列表，为空表示所有
        items:
          type: integer
      filter:
        properties:
          host_name:
            type: string
            description: 可模糊搜索
          host_group:
            type: array
            items:
              type: string
          repo:
            type: array
            items:
              type: string
          status:
            type: array
            items:
              type: string
            example:
              - scanning
              - done
  QueryHostScanStatusRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                additionalProperties:
                  type: string
  QueryCveActionReq:
    properties:
      cve_list:
        type: array
        description: 需查询的cve列表
        items:
          type: string
  QueryCveActionRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    reboot:
                      type: boolean
                    package:
                      type: string
  SetCveStatusReq:
    properties:
      cve_list:
        type: array
        description: cve id列表
        items:
          type: string
      status:
        description: >-
          可选not reviewed(未关注)、in review(关注中)、on-hold(挂起)、resolved(已解决)、no
          action(已忽略).
        type: string
  QueryCveTaskHostReq:
    properties:
      cve_list:
        description: cve id 列表
        type: array
        items:
          type: string
      filter:
        description: 查询条件
        type: object
        properties:
          fixed:
            type: boolean

  QueryCveTaskHostRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                additionalProperties:
                  description: cve的相关主机的基本信息
                  type: array
                  items:
                    type: object
                    properties:
                      host_id:
                        type: string
                      host_name:
                        type: string
                      host_ip:
                        type: string
  QueryCveHostReq:
    required:
      - cve_id
    properties:
      cve_id:
        type: string
      sort:
        type: string
        description: 可选last_scan
      direction:
        type: string
        description: 升序(asc)，降序(desc)，默认:asc
      page:
        type: integer
        description: 当前页码
      per_page:
        type: integer
        description: 每页数量,最大值50
      filter:
        properties:
          host_name:
            type: string
            description: 可模糊搜索
          host_group:
            type: array
            items:
              type: string
          fixed:
            type: boolean
            description: CVE在具体主机的修复状态,默认为False
          hp_status:
            type: array
            items:
              type: string
              description: 已修复主机的热补丁状态，可选ACTIVED, ACCEPTED, 仅用于fixed为True的筛选
          repo:
            type: array
            items:
              type: string
        required:
          - fixed
  QueryCveHostRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            properties:
              total_count:
                type: integer
                description: 总数
              total_page:
                type: integer
                description: 总页数
              result:
                type: array
                description: CVE信息
                items:
                  properties:
                    host_id:
                      type: integer
                      format: int32
                    host_name:
                      type: string
                    host_ip:
                      type: string
                    host_group:
                      type: string
                    repo:
                      type: string
                    status:
                      type: string
                    last_scan:
                      type: integer
                    hotpatch:
                      type: boolean
                      description: 是否支持热修复
  QueryCveInfoReq:
    properties:
      cve_id:
        type: string
  QueryCveInfoRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: object
                properties:
                  cve_id:
                    type: string
                  publish_time:
                    type: string
                  severity:
                    type: string
                  description:
                    type: string
                  cvss_score:
                    type: string
                  status:
                    type: string
  QueryCveListReq:
    properties:
      sort:
        type: string
        description: 可选cve_id、publish_time、cvss_score、host_num
      direction:
        type: string
        description: 升序(asc)，降序(desc)，默认:asc
      page:
        type: integer
        description: 当前页码
      per_page:
        type: integer
        description: 每页数量,最大值50
      filter:
        properties:
          cve_id:
            type: string
            description: 可模糊搜索
          severity:
            type: array
            items:
              type: string
          status:
            type: array
            items:
              type: string
          affected:
            type: boolean
            description: 默认为True
          fixed:
            type: boolean
        required:
          - affected
          - fixed
    type: object
  QueryCveListRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              total_count:
                type: integer
                description: 总数
              total_page:
                type: integer
                description: 总页数
              result:
                type: array
                description: CVE信息
                items:
                  type: object
                  properties:
                    cve_id:
                      type: string
                    publish_time:
                      type: string
                    severity:
                      type: string
                    description:
                      type: string
                    cvss_score:
                      type: string
                    hosts_num:
                      type: integer
                    status:
                      type: string
                  example:
                    cve_id: id1
                    publish_time: 2020-09-24
                    severity: high
                    description: a long description
                    cvss_score: '7.2'
                    hosts_num: 22
                    status: in review
  QueryOverviewRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                properties:
                  critical:
                    type: integer
                  high:
                    type: integer
                  medium:
                    type: integer
                  low:
                    type: integer
                  unknown:
                    type: integer
                    format: int32
  RepoDeleteRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              succeed_list:
                type: array
                items:
                  type: string
              fail_list:
                type: array
                items:
                  type: string
  RepoDeleteReq:
    required:
      - repo_name_list
    properties:
      repo_name_list:
        description: repo名字列表,非空
        type: array
        items:
          type: string
        minItems: 1
  RepoGetReq:
    required:
      - repo_name_list
    properties:
      repo_name_list:
        type: array
        items:
          type: string
        minItems: 0
  RepoGetRsp:
    allOf:
      - $ref: '#/definitions/GeneralRsp'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: array
                items:
                  $ref: '#/definitions/RepoData'
  RepoImportReq:
    required:
      - repo_name
      - repo_data
    properties:
      repo_name:
        type: string
        description: repo名字
      repo_data:
        type: string
        description: repo内容
  RepoData:
    type: object
    properties:
      repo_name:
        type: string
      repo_data:
        type: string
      repo_attr:
        type: string
        description: os版本
  GeneralRsp:
    description: 通用返回信息
    required:
      - code
      - message
      - label
    properties:
      code:
        description: 状态码
        type: integer
        minLength: 8
        maxLength: 36
      message:
        description: 描述信息
        type: string
        minLength: 2
        maxLength: 512
      label:
        description: 状态码对应的含义
        type: string
        minLength: 2
        maxLength: 512
  ErrorRsp:
    description: 失败时返回的错误对象
    required:
      - code
      - msg
      - label
    properties:
      code:
        description: 错误码
        type: integer
        minLength: 8
        maxLength: 36
      msg:
        description: 错误描述
        type: string
        minLength: 2
        maxLength: 512
      label:
        description: 错误状态码的含义
        type: string
        minLength: 2
        maxLength: 512
    example:
      code: 400
      msg: error msg
      label: 请求出错
  UploadCveAdvisoryRsp:
    type: object
    required:
      - title
      - file
      - type
    properties:
      title:
        type: string
        description: 文件名称
      file:
        type: string
        format: binary
        description: 文件
      type:
        type: string
        description: 文件类型
  RepoSetCallbackReq:
    type: object
    properties:
      host_id:
        type: string
      repo_name:
        type: string
      status:
        type: string
        description: succeed/fail
      task_id:
        type: string
  CveScanCallbackReq:
    type: object
    properties:
      task_id:
        type: string
      host_id:
        type: string
      status:
        type: string
        description: succeed/fail
      os_version:
        type: string
      installed_packages:
        type: array
        items:
          type: object
          properties:
            name:
              type: string
            version:
              type: boolean
          description: 主机安装的软件包名列表
      unfixed_cves:
        type: array
        items:
          type: object
          properties:
            cve_id:
              type: string
            support_hp:
              type: boolean
      fixed_cves:
        type: array
        items:
          type: object
          properties:
            cve_id:
              type: string
            fixed_by_hp:
              type: boolean

  CveFixCallbackReq:
    type: object
    properties:
      task_id:
        type: string
      host_id:
        type: string
      cves:
        type: object
        additionalProperties:
          type: string
        description: cveid 与修复结果(succeed/fail)
        example:
          cve_id_1: succeed
          cve_id_2: fail
  ExportCveReq:
    type: object
    required:
      - host_list
    properties:
      host_list:
        type: array
        items:
          type: integer
        description: 空表示全部
  GenerateRollbackTaskReq:
    required:
      - task_name
      - description
      - info
    properties:
      task_name:
        type: string
        description: 任务名称
      description:
        type: string
        description: 任务描述
      info:
        type: array
        description: 需要修复的主机与cve的信息
        items:
          properties:
            host_id:
              type: integer
            cves:
              type: array
              items:
                properties:
                  cve_id:
                    type: string
                  hotpatch:
                    type: boolean
  CveRollbackCallbackReq:
    type: object
    properties:
      task_id:
        type: string
      host_id:
        type: string
      cves:
        type: array
        items:
          type: object
          properties:
            cve_id:
              type: string
            result:
              type: string
            log:
              type: string
        description: cve_id, 回滚结果(succeed/fail/unknown),日志
